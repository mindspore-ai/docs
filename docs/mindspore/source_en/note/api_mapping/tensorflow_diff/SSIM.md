# Function Differences with tf.image.ssim

<a href="https://gitee.com/mindspore/docs/blob/master/docs/mindspore/source_en/note/api_mapping/tensorflow_diff/SSIM.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.png"></a>

## tf.image.ssim

```text
tf.image.ssim(
    img1,
    img2,
    max_val,
    filter_size=11,
    filter_sigma=1.5,
    k1=0.01,
    k2=0.03
) -> Tensor
```

For more information, see [tf.image.ssim](https://tensorflow.google.cn/versions/r2.6/api_docs/python/tf/image/ssim).

## mindspore.nn.SSIM

```text
class mindspore.nn.SSIM(
    max_val=1.0,
    filter_size=11,
    filter_sigma=1.5,
    k1=0.01,
    k2=0.03
)(img1, img2) -> Tensor
```

For more information, see [mindspore.nn.SSIM](https://www.mindspore.cn/docs/en/r1.9/api_python/nn/mindspore.nn.SSIM.html).

## Differences

TensorFlow: In TensorFlow, the operator is functional, taking the two images directly from the input and returning the result. The `max_val` parameter cannot be defaulted and the format of accepted images is "NHWC".

MindSpore: In MindSpore, the operator needs to be instantiated first and then receive the input and return the result. The format of the accepted image is "NCHW".

| Categories | Subcategories |TensorFlow | MindSpore | Differences |
| --- | --- | --- | --- |---|
| Parameters | parameter 1 | img1         | img1         | MindSpore receives this input in the instantiated function, which is functionally consistent            |
|      | parameter 2 | img2         | img2         |MindSpore receives this input in the instantiated function, which is functionally consistent            |
|      | parameter 3 | max_val      | max_val      | This parameter is required in TensorFlow and can be defaulted in MindSpore, and the default value is `1.0`. |
|      | parameter 4 | filter_size  | filter_size  | -   |
|      | parameter 5 | filter_sigma | filter_sigma | -    |
|      | parameter 6 | k1           | k1           | -   |
|      | parameter 7 | k2           | k2          | -   |

### Code Example 1

> The parameter `max_val` is required in TensorFlow and can be defaulted in MindSpore, with a default value of `1.0`. Note that in this example, TensorFlow and MindSpore input images `img1`, `img2` are in different image formats. For TensorFlow image input format is "NHWC", the input shape of img1, img2 is `[1, 16, 16, 3]`. To ensure that MindSpore has logically equivalent input, the input image shape for MindSpore in this example is `[1, 3, 16, 16]`.

```python
# TensorFlow
import numpy as np
import tensorflow as tf

img1 = tf.ones([1, 16, 16, 3], dtype=tf.float32)
img2 = tf.ones([1, 16, 16, 3], dtype=tf.float32)
output = tf.image.ssim(img1, img2, max_val=1.0)
print(output.numpy())
# [1.]

# MindSpore
import numpy as np
import mindspore.nn as nn
from mindspore import Tensor

net = nn.SSIM()
img1 = Tensor(np.ones([1, 3, 16, 16]).astype(np.float32))
img2 = Tensor(np.ones([1, 3, 16, 16]).astype(np.float32))
output = net(img1, img2)
print(output)
# [1.]
```

### Code Example 2

> The accepted format of image input is "NHWC" in TensorFlow and "NCHW" in MindSpore. The following example uses a 4D tensor generated by the same random seed, and after the `(0, 3, 1, 2)` axis transformation in MindSpore, we can get the same result as TensorFlow.

```python
# TensorFlow
import numpy as np
import tensorflow as tf

np.random.seed(10)
img1 = np.random.randint(0, 2, (2, 5, 5, 5)).astype(np.float32)
img2 = np.random.randint(0, 2, (2, 5, 5, 5)).astype(np.float32)
output = tf.image.ssim(img1, img2, max_val=1, filter_size=3)
print(output.numpy())
# [-0.00746754 -0.09539266]

# MindSpore
import numpy as np
import mindspore
from mindspore import nn, ops, Tensor

np.random.seed(10)
img1 = np.random.randint(0, 2, (2, 5, 5, 5)).astype(np.float32)
img2 = np.random.randint(0, 2, (2, 5, 5, 5)).astype(np.float32)
img1_t = Tensor(img1)
img2_t = Tensor(img2)
net = nn.SSIM(filter_size=3)
transpose = ops.Transpose()
trans_term = (0, 3, 1, 2)
img1_trans = transpose(img1_t, trans_term)
img2_trans = transpose(img2_t, trans_term)
output_m = net(img1_trans, img2_trans)
print(output_m)
# [-0.00746753 -0.09539266]
```


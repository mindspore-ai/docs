# åœ¨MCUæˆ–å°å‹ç³»ç»Ÿä¸Šæ‰§è¡Œæ¨ç†æˆ–è®­ç»ƒ

<a href="https://gitee.com/mindspore/docs/blob/r2.0.0-alpha/docs/lite/docs/source_zh_cn/use/micro.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source.png"></a>

## æ¦‚è¿°

æœ¬æ•™ç¨‹ä»‹ç»é¢å‘IoTè¾¹ç¼˜ä¾§è®¾å¤‡çš„è¶…è½»é‡AIéƒ¨ç½²æ–¹æ¡ˆã€‚

ç›¸è¾ƒäºç§»åŠ¨è®¾å¤‡ï¼ŒIoTè®¾å¤‡ä¸Šé€šå¸¸ä½¿ç”¨MicroControllerUnits(MCUs)ï¼Œä¸ä»…è®¾å¤‡ç³»ç»ŸROMèµ„æºéå¸¸æœ‰é™ï¼Œè€Œä¸”ç¡¬ä»¶èµ„æºå†…å­˜å’Œç®—åŠ›éƒ½éå¸¸å¼±å°ã€‚
å› æ­¤IOTè®¾å¤‡ä¸Šçš„AIåº”ç”¨å¯¹AIæ¨¡å‹æ¨ç†çš„è¿è¡Œæ—¶å†…å­˜å’ŒåŠŸè€—éƒ½æœ‰ä¸¥æ ¼é™åˆ¶ã€‚
MindSpore Liteé’ˆå¯¹MCUséƒ¨ç½²ç¡¬ä»¶åç«¯ï¼Œæä¾›äº†ä¸€ç§è¶…è½»é‡Micro AIéƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼šç¦»çº¿é˜¶æ®µç›´æ¥å°†æ¨¡å‹ç”Ÿæˆè½»é‡åŒ–ä»£ç ï¼Œä¸å†éœ€è¦åœ¨çº¿è§£ææ¨¡å‹å’Œå›¾ç¼–è¯‘ï¼Œç”Ÿæˆçš„Microä»£ç éå¸¸ç›´è§‚æ˜“æ‡‚ï¼Œè¿è¡Œæ—¶å†…å­˜å°ï¼Œä»£ç ä½“ç§¯ä¹Ÿæ›´å°ã€‚
ç”¨æˆ·ä½¿ç”¨MindSpore Liteè½¬æ¢å·¥å…·`converter_lite`éå¸¸å®¹æ˜“ç”Ÿæˆå¯åœ¨x86/ARM64/ARM32/Cortex-Må¹³å°éƒ¨ç½²çš„æ¨ç†æˆ–è®­ç»ƒä»£ç ã€‚

é€šè¿‡Microéƒ¨ç½²ä¸€ä¸ªæ¨¡å‹è¿›è¡Œæ¨ç†æˆ–è®­ç»ƒï¼Œé€šå¸¸åŒ…å«ä»¥ä¸‹å››æ­¥ï¼šæ¨¡å‹ä»£ç ç”Ÿæˆã€`Micro`åº“è·å–ã€ä»£ç é›†æˆã€ç¼–è¯‘éƒ¨ç½²ã€‚

## æ¨¡å‹æ¨ç†ä»£ç ç”Ÿæˆ

### æ¦‚è¿°

é€šè¿‡MindSpore Liteè½¬æ¢å·¥å…·`converter_lite`ï¼Œå¹¶åœ¨è½¬æ¢å·¥å…·çš„å‚æ•°é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®Microé…ç½®é¡¹ï¼Œå°±èƒ½ä¸ºè¾“å…¥æ¨¡å‹ç”Ÿæˆæ¨ç†ä»£ç ã€‚
æ­¤ç« åªä»‹ç»è½¬æ¢å·¥å…·ä¸­ç”Ÿæˆä»£ç çš„ç›¸å…³åŠŸèƒ½ï¼Œå…³äºè½¬æ¢å·¥å…·çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œè¯·å‚è€ƒ[æ¨ç†æ¨¡å‹è½¬æ¢](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/converter_tool.html)ã€‚

### ç¯å¢ƒå‡†å¤‡

ä»¥Linuxç¯å¢ƒä¸‹ä½¿ç”¨è½¬æ¢å·¥å…·ä¸ºä¾‹ï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹ç¯å¢ƒå‡†å¤‡ã€‚

1. è½¬æ¢å·¥å…·è¿è¡Œæ‰€éœ€çš„ç³»ç»Ÿç¯å¢ƒ

    æœ¬ä¾‹é‡‡ç”¨Linuxä¸‹çš„ç³»ç»Ÿç¯å¢ƒï¼Œæ¨èä½¿ç”¨Ubuntu 18.04.02LTSã€‚

2. è·å–è½¬æ¢å·¥å…·

    å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è·å–è½¬æ¢å·¥å…·ï¼š

    - MindSporeå®˜ç½‘ä¸‹è½½[Releaseç‰ˆæœ¬](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/downloads.html)ã€‚

        ç”¨æˆ·éœ€ä¸‹è½½æ“ä½œç³»ç»Ÿä¸ºLinux-x86_64ï¼Œç¡¬ä»¶å¹³å°ä¸ºCPUçš„å‘å¸ƒåŒ…ã€‚

    - ä»æºç å¼€å§‹[ç¼–è¯‘æ„å»º](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/build.html)ã€‚

3. è§£å‹ä¸‹è½½çš„åŒ…

    ```bash
    tar -zxf mindspore-lite-${version}-linux-x64.tar.gz
    ```

    ${version}æ˜¯å‘å¸ƒåŒ…çš„ç‰ˆæœ¬å·ã€‚

4. å°†è½¬æ¢å·¥å…·è¿è¡Œæ—¶éœ€è¦çš„åŠ¨æ€é“¾æ¥åº“åŠ å…¥ç¯å¢ƒå˜é‡LD_LIBRARY_PATH

    ```bash
    export LD_LIBRARY_PATH=${PACKAGE_ROOT_PATH}/tools/converter/lib:${LD_LIBRARY_PATH}
    ```

    ${PACKAGE_ROOT_PATH}æ˜¯è§£å‹å¾—åˆ°çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚

### æ‰§è¡Œconverter_liteç”Ÿæˆæ¨ç†ä»£ç 

1. è¿›å…¥è½¬æ¢ç›®å½•

    ```bash
    cd ${PACKAGE_ROOT_PATH}/tools/converter/converter
    ```

2. è®¾ç½®Microé…ç½®é¡¹

    åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»º`micro.cfg`æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

    ```text
    [micro_param]

    # enable code-generation for MCU HW

    enable_micro=true

    # specify HW target, support x86,Cortex-M, AMR32A, ARM64 only.

    target=x86

    # enable parallel inference or not.

    support_parallel=false

    ```

    é…ç½®æ–‡ä»¶ä¸­ï¼Œç¬¬ä¸€è¡Œçš„`[micro_param]`è¡¨æ˜åç»­çš„å˜é‡å‚æ•°å±äºMicroé…ç½®é¡¹`micro_param`ï¼Œè¿™äº›å‚æ•°ç”¨äºæ§åˆ¶ä»£ç ç”Ÿæˆï¼Œå„å‚æ•°å«ä¹‰å¦‚ä¸‹è¡¨1æ‰€ç¤ºã€‚
    æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ç”Ÿæˆé€‚ç”¨åº•å±‚æ¶æ„ä¸ºx86_64çš„Linuxç³»ç»Ÿä¸Šçš„æ¨ç†ä»£ç ï¼Œæ•…è®¾ç½®`target=x86`ä»¥å£°æ˜ç”Ÿæˆçš„æ¨ç†ä»£ç å°†ç”¨äºåº•å±‚æ¶æ„ä¸ºx86_64çš„Linuxç³»ç»Ÿã€‚

3. å‡†å¤‡è¦ç”Ÿæˆæ¨ç†ä»£ç çš„æ¨¡å‹

    ç”¨æˆ·å¯ç‚¹å‡»æ­¤å¤„ä¸‹è½½æœ¬ä¾‹ä¸­ç”¨åˆ°çš„[MNISTæ‰‹å†™æ•°å­—è¯†åˆ«æ¨¡å‹](https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/mnist.tar.gz)ã€‚
    ä¸‹è½½åï¼Œè§£å‹åŒ…ï¼Œå¾—åˆ°`mnist.tflite`ï¼Œè¯¥æ¨¡å‹ä¸ºå·²ç»è®­ç»ƒå®Œçš„MNISTåˆ†ç±»æ¨¡å‹ï¼Œä¸ºTFLITEæ¨¡å‹ã€‚å°†`mnist.tflite`æ¨¡å‹æ‹·è´åˆ°å½“å‰æ‰€åœ¨çš„è½¬æ¢å·¥å…·ç›®å½•ã€‚

4. æ‰§è¡Œconverter_liteï¼Œç”Ÿæˆä»£ç 

    ```bash
    ./converter_lite --fmk=TFLITE --modelFile=mnist.tflite --outputFile=mnist --configFile=micro.cfg
    ```

    è¿è¡ŒæˆåŠŸåçš„ç»“æœæ˜¾ç¤ºä¸ºï¼š

    ```text
    CONVERTER RESULT SUCCESS:0
    ```

    ç”¨æˆ·è‹¥æƒ³äº†è§£converter_liteè½¬æ¢å·¥å…·çš„ç›¸å…³å‚æ•°ï¼Œå¯å‚è€ƒ[converterå‚æ•°è¯´æ˜](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/converter_tool.html#å‚æ•°è¯´æ˜)ã€‚

    åœ¨è½¬æ¢å·¥å…·æ‰§è¡ŒæˆåŠŸåï¼Œç”Ÿæˆçš„ä»£ç è¢«ä¿å­˜åœ¨ç”¨æˆ·æŒ‡å®šçš„`outputFile`è·¯å¾„ä¸‹ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œä¸ºå½“å‰è½¬æ¢ç›®å½•ä¸‹çš„mnistæ–‡ä»¶å¤¹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

    ```text
    mnist                          # æŒ‡å®šçš„ç”Ÿæˆä»£ç æ ¹ç›®å½•åç§°
    â”œâ”€â”€ benchmark                  # å¯¹æ¨¡å‹æ¨ç†ä»£ç è¿›è¡Œé›†æˆè°ƒç”¨çš„benchmarkä¾‹ç¨‹
    â”‚   â”œâ”€â”€ benchmark.c
    â”‚   â”œâ”€â”€ calib_output.c
    â”‚   â”œâ”€â”€ calib_output.h
    â”‚   â”œâ”€â”€ load_input.c
    â”‚   â””â”€â”€ load_input.h
    â”œâ”€â”€ CMakeLists.txt             # benchmarkä¾‹ç¨‹çš„cmakeå·¥ç¨‹æ–‡ä»¶
    â””â”€â”€ src                        # æ¨¡å‹æ¨ç†ä»£ç ç›®å½•
        â”œâ”€â”€ CMakeLists.txt
        â”œâ”€â”€ net.bin                # äºŒè¿›åˆ¶å½¢å¼çš„æ¨¡å‹æƒé‡
        â”œâ”€â”€ net.c
        â”œâ”€â”€ net.cmake
        â”œâ”€â”€ net.h
        â”œâ”€â”€ model.c
        â”œâ”€â”€ context.c
        â”œâ”€â”€ context.h
        â”œâ”€â”€ tensor.c
        â”œâ”€â”€ tensor.h
        â”œâ”€â”€ weight.c
        â””â”€â”€ weight.h
    ```

    ç”Ÿæˆä»£ç ä¸­çš„`src`ç›®å½•å³ä¸ºæ¨¡å‹æ¨ç†ä»£ç æ‰€åœ¨ç›®å½•ï¼Œ`benchmark`åªæ˜¯å¯¹`src`ç›®å½•ä»£ç è¿›è¡Œé›†æˆè°ƒç”¨çš„ä¸€ä¸ªä¾‹ç¨‹ã€‚
    å…³äºé›†æˆè°ƒç”¨çš„æ›´å¤šè¯¦ç»†è¯´æ˜ï¼Œè¯·å‚ç…§[ä»£ç é›†æˆåŠç¼–è¯‘éƒ¨ç½²](#ä»£ç é›†æˆåŠç¼–è¯‘éƒ¨ç½²)ç« èŠ‚ã€‚

è¡¨1ï¼šmicro_paramå‚æ•°å®šä¹‰

| å‚æ•°            | æ˜¯å¦å¿…é€‰ | å‚æ•°è¯´æ˜                         | å–å€¼èŒƒå›´                   | é»˜è®¤å€¼    |
| --------------- | -------- | ------------------------------| --------------------------| --------- |
| enable_micro    | æ˜¯       | æ¨¡å‹ä¼šç”Ÿæˆä»£ç ï¼Œå¦åˆ™ç”Ÿæˆ.ms       | true, false                | false      |
| target          | æ˜¯       | ç”Ÿæˆä»£ç é’ˆå¯¹çš„å¹³å°               | x86, Cortex-M, ARM32, ARM64 | x86       |
| support_parallel | å¦       | æ˜¯å¦ç”Ÿæˆå¤šçº¿ç¨‹æ¨ç†ä»£ç ï¼Œä»…åœ¨x86ã€ARM32ã€ARM64å¹³å°å¯è®¾ç½®ä¸ºtrue | true, false     | false    |

### æ¨¡å‹è¾“å…¥shapeé…ç½®(å¯é€‰)

é€šå¸¸åœ¨ç”Ÿæˆä»£ç æ—¶ï¼Œé€šè¿‡é…ç½®æ¨¡å‹è¾“å…¥shapeä¸ºå®é™…æ¨ç†æ—¶çš„è¾“å…¥shapeï¼Œå¯ä»¥å‡å°‘éƒ¨ç½²è¿‡ç¨‹ä¸­å‡ºé”™çš„æ¦‚ç‡ã€‚
å½“æ¨¡å‹å«æœ‰`Shape`ç®—å­æˆ–è€…åŸæ¨¡å‹è¾“å…¥shapeéå›ºå®šå€¼æ—¶ï¼Œå¿…é¡»é…ç½®æ¨¡å‹çš„è¾“å…¥shapeå€¼ï¼Œä»¥æ”¯æŒç›¸å…³shapeä¼˜åŒ–å’Œä»£ç ç”Ÿæˆã€‚
é€šè¿‡è½¬æ¢å·¥å…·çš„`--inputShape=`å‘½ä»¤å¯ä»¥é…ç½®ç”Ÿæˆä»£ç çš„è¾“å…¥shapeï¼Œå…·ä½“å‚æ•°å«ä¹‰ï¼Œè¯·å‚è€ƒ[è½¬æ¢å·¥å…·ä½¿ç”¨è¯´æ˜](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/converter_tool.html)ã€‚

### ç”Ÿæˆå¤šçº¿ç¨‹å¹¶è¡Œæ¨ç†ä»£ç (å¯é€‰)

åœ¨é€šå¸¸çš„Linux-x86/Androidç¯å¢ƒä¸‹ï¼Œæ‹¥æœ‰å¤šæ ¸CPUï¼Œä½¿èƒ½Microå¤šçº¿ç¨‹æ¨ç†èƒ½å¤Ÿå‘æŒ¥è®¾å¤‡æ€§èƒ½ï¼ŒåŠ å¿«æ¨¡å‹æ¨ç†é€Ÿåº¦ã€‚

#### é…ç½®æ–‡ä»¶

é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®support_parallelä¸ºtrueï¼Œå°†ç”Ÿæˆæ”¯æŒå¤šçº¿ç¨‹æ¨ç†çš„ä»£ç ï¼Œå…³äºé…ç½®æ–‡ä»¶å„é€‰é¡¹å«ä¹‰è¯·å‚è€ƒè¡¨1ã€‚
ä¸€ä¸ª `x86` çš„å¤šçº¿ç¨‹ä»£ç ç”Ÿæˆé…ç½®æ–‡ä»¶çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š

```text
[micro_param]

# enable code-generation for MCU HW

enable_micro=true

# specify HW target, support x86,Cortex-M, AMR32A, ARM64 only.

target=x86

# enable parallel inference or not.

support_parallel=true

```

#### æ¶‰åŠçš„è°ƒç”¨æ¥å£

é€šè¿‡é›†æˆä»£ç ï¼Œå¹¶è°ƒç”¨ä¸‹è¿°æ¥å£ï¼Œç”¨æˆ·å¯ä»¥é…ç½®æ¨¡å‹çš„å¤šçº¿ç¨‹æ¨ç†ï¼Œå…·ä½“æ¥å£å‚æ•°è¯·å‚è€ƒ[APIæ–‡æ¡£](https://www.mindspore.cn/lite/api/zh-CN/r2.0.0-alpha/index.html)ã€‚

è¡¨2ï¼šå¤šçº¿ç¨‹é…ç½®APIæ¥å£

| åŠŸèƒ½             | å‡½æ•°åŸå‹                                                                |
| ---------------- | ----------------------------------------------------------------------- |
| è®¾ç½®æ¨ç†æ—¶çº¿ç¨‹æ•° | void MSContextSetThreadNum(MSContextHandle context, int32_t thread_num) |
| è®¾ç½®çº¿ç¨‹ç»‘æ ¸æ¨¡å¼ | void MSContextSetThreadAffinityMode(MSContextHandle context, int mode)  |
| è·å–æ¨ç†æ—¶çº¿ç¨‹æ•° | int32_t MSContextGetThreadNum(const MSContextHandle context);           |
| è·å–çº¿ç¨‹ç»‘æ ¸æ¨¡å¼ | int MSContextGetThreadAffinityMode(const MSContextHandle context)       |

#### é›†æˆè¯´æ˜

ç”Ÿæˆå¤šçº¿ç¨‹ä»£ç åï¼Œç”¨æˆ·éœ€é“¾æ¥`pthread`æ ‡å‡†åº“ï¼Œä»¥åŠMicroåº“å†…çš„`libwrapper.a`é™æ€åº“ã€‚å…·ä½“å¯å‚è€ƒç”Ÿæˆä»£ç ä¸­çš„`CMakeLists.txt`æ–‡ä»¶ã€‚

#### é™åˆ¶è¯´æ˜

ç›®å‰è¯¥åŠŸèƒ½ä»…åœ¨ `target` é…ç½®ä¸ºx86/ARM32/ARM64æ—¶ä½¿èƒ½ï¼Œæœ€å¤§å¯è®¾ç½®æ¨ç†çº¿ç¨‹æ•°ä¸º4çº¿ç¨‹ã€‚

### ç”ŸæˆInt8é‡åŒ–æ¨ç†ä»£ç (å¯é€‰)

åœ¨Cortex-Mç­‰MCUåœºæ™¯ä¸‹ï¼Œå—é™äºè®¾å¤‡çš„å†…å­˜å¤§å°åŠç®—åŠ›ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨Int8é‡åŒ–ç®—å­æ¥è¿›è¡Œéƒ¨ç½²æ¨ç†ä»¥å‡å°‘è¿è¡Œæ—¶å†…å­˜å¤§å°å¹¶åŠ é€Ÿè¿ç®—ã€‚

å¦‚æœç”¨æˆ·å·²ç»æœ‰ä¸€ä¸ªInt8å…¨é‡åŒ–æ¨¡å‹ï¼Œå¯å‚è€ƒ[æ‰§è¡Œconverter_liteç”Ÿæˆæ¨ç†ä»£ç ](#æ‰§è¡Œconverter-liteç”Ÿæˆæ¨ç†ä»£ç )ç« èŠ‚å°è¯•ç›´æ¥ç”ŸæˆInt8é‡åŒ–æ¨ç†ä»£ç è€Œä¸éœ€è¦é˜…è¯»æœ¬ç« å†…å®¹ã€‚
åœ¨é€šå¸¸çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·åªæœ‰ä¸€ä¸ªè®­ç»ƒå¥½çš„Float32æ¨¡å‹ï¼Œæ­¤æ—¶è‹¥è¦ç”ŸæˆInt8é‡åŒ–æ¨ç†ä»£ç ï¼Œåˆ™éœ€é…åˆè½¬æ¢å·¥å…·çš„åé‡åŒ–åŠŸèƒ½è¿›è¡Œä»£ç ç”Ÿæˆï¼Œå…·ä½“æ­¥éª¤å¯å‚è€ƒä¸‹æ–‡ã€‚

#### é…ç½®æ–‡ä»¶

é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®é‡åŒ–æ§åˆ¶å‚æ•°å¯ä»¥å®ç°Int8é‡åŒ–æ¨ç†ä»£ç ç”Ÿæˆï¼Œå…³äºé‡åŒ–æ§åˆ¶å‚æ•°ï¼ˆé€šç”¨é‡åŒ–å‚æ•°`common_quant_param`å’Œå…¨é‡åŒ–å‚æ•°`full_quant_param`ï¼‰çš„è¯´æ˜ï¼Œè¯·å‚è€ƒè½¬æ¢å·¥å…·çš„[è®­ç»ƒåé‡åŒ–æ–‡æ¡£](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/post_training_quantization.html)ã€‚

ä¸€ä¸ª `Cortex-M` å¹³å°çš„Int8é‡åŒ–æ¨ç†ä»£ç ç”Ÿæˆé…ç½®æ–‡ä»¶çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š

```text
[micro_param]
# enable code-generation for MCU HW
enable_micro=true

# specify HW target, support x86,Cortex-M, ARM32, ARM64 only.
target=Cortex-M

# code generation for Inference or Train
codegen_mode=Inference

# enable parallel inference or not
support_parallel=false

[common_quant_param]
# Supports WEIGHT_QUANT or FULL_QUANT
quant_type=FULL_QUANT

# Weight quantization support the number of bits [0,16], Set to 0 is mixed bit quantization, otherwise it is fixed bit quantization
# Full quantization support the number of bits [1,8]
bit_num=8

[data_preprocess_param]

calibrate_path=inputs:/home/input_dir

calibrate_size=100

input_type=BIN

[full_quant_param]

activation_quant_method=MAX_MIN

bias_correction=true

target_device=DSP

```

##### é™åˆ¶è¯´æ˜

- ç›®å‰ä»…æ”¯æŒå…¨é‡åŒ–çš„æ¨ç†ä»£ç ç”Ÿæˆã€‚

- é…ç½®æ–‡ä»¶ä¸­å…¨é‡åŒ–å‚æ•°`full_quant_param`çš„target_deviceé€šå¸¸éœ€è®¾ç½®ä¸ºDSPï¼Œä»¥æ”¯æŒæ›´å¤šçš„ç®—å­è¿›è¡Œåé‡åŒ–ã€‚

- ç›®å‰Microå·²æ”¯æŒ34ä¸ªInt8é‡åŒ–ç®—å­ï¼Œå¦‚æœåœ¨ç”Ÿæˆä»£ç æ—¶ï¼Œæœ‰ç›¸å…³é‡åŒ–ç®—å­ä¸æ”¯æŒï¼Œå¯é€šè¿‡é€šç”¨é‡åŒ–å‚æ•°`common_quant_param`çš„`skip_quant_node`æ¥è§„é¿è¯¥ç®—å­ï¼Œè¢«è§„é¿çš„ç®—å­èŠ‚ç‚¹ä»ç„¶é‡‡ç”¨Float32æ¨ç†ã€‚

## æ¨¡å‹è®­ç»ƒä»£ç ç”Ÿæˆ

### æ¦‚è¿°

é€šè¿‡MindSpore Liteè½¬æ¢å·¥å…·`converter_lite`ï¼Œå¹¶åœ¨è½¬æ¢å·¥å…·çš„å‚æ•°é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®Microé…ç½®é¡¹ï¼Œå°±èƒ½ä¸ºè¾“å…¥æ¨¡å‹ç”Ÿæˆè®­ç»ƒä»£ç ã€‚
æ­¤ç« åªä»‹ç»è½¬æ¢å·¥å…·ä¸­ç”Ÿæˆä»£ç çš„ç›¸å…³åŠŸèƒ½ï¼Œå…³äºè½¬æ¢å·¥å…·çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œè¯·å‚è€ƒ[è®­ç»ƒæ¨¡å‹è½¬æ¢](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/converter_train.html)ã€‚

### ç¯å¢ƒå‡†å¤‡

ç¯å¢ƒå‡†å¤‡å°èŠ‚å‚è€ƒ[ä¸Šæ–‡](#ç¯å¢ƒå‡†å¤‡)ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚

### æ‰§è¡Œconverter_liteç”Ÿæˆæ¨ç†ä»£ç 

1. è¿›å…¥è½¬æ¢ç›®å½•

    ```bash
    cd ${PACKAGE_ROOT_PATH}/tools/converter/converter
    ```

2. è®¾ç½®Microé…ç½®é¡¹

    åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»º`micro.cfg`æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

    ```text
    [micro_param]

    # enable code-generation for MCU HW

    enable_micro=true

    # specify HW target, support x86,Cortex-M, AMR32A, ARM64 only.

    target=x86

    # code generation for Inference or Train. Cortex-M is unsupported when codegen_mode is Train.

    codegen_mode=Train

    ```

3. æ‰§è¡Œconverter_liteï¼Œç”Ÿæˆä»£ç 

    ```bash
    ./converter_lite --fmk=MINDIR --trainModel=True --modelFile=my_model.mindir --outputFile=my_model --configFile=micro.cfg
    ```

    è¿è¡ŒæˆåŠŸåçš„ç»“æœæ˜¾ç¤ºä¸ºï¼š

    ```text
    CONVERTER RESULT SUCCESS:0
    ```

    åœ¨è½¬æ¢å·¥å…·æ‰§è¡ŒæˆåŠŸåï¼Œç”Ÿæˆçš„ä»£ç è¢«ä¿å­˜åœ¨ç”¨æˆ·æŒ‡å®šçš„`outputFile`è·¯å¾„ä¸‹ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œä¸ºå½“å‰è½¬æ¢ç›®å½•ä¸‹çš„my_modelæ–‡ä»¶å¤¹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

    ```text
    my_model                       # æŒ‡å®šçš„ç”Ÿæˆä»£ç æ ¹ç›®å½•åç§°
    â”œâ”€â”€ benchmark                  # å¯¹æ¨¡å‹è®­ç»ƒä»£ç è¿›è¡Œé›†æˆè°ƒç”¨çš„benchmarkä¾‹ç¨‹
    â”‚   â”œâ”€â”€ benchmark.c
    â”‚   â”œâ”€â”€ calib_output.c
    â”‚   â”œâ”€â”€ calib_output.h
    â”‚   â”œâ”€â”€ load_input.c
    â”‚   â””â”€â”€ load_input.h
    â”œâ”€â”€ CMakeLists.txt             # benchmarkä¾‹ç¨‹çš„cmakeå·¥ç¨‹æ–‡ä»¶
    â””â”€â”€ src                        # æ¨¡å‹æ¨ç†ä»£ç ç›®å½•
        â”œâ”€â”€ CMakeLists.txt
        â”œâ”€â”€ net.bin                # äºŒè¿›åˆ¶å½¢å¼çš„æ¨¡å‹æƒé‡
        â”œâ”€â”€ net.c
        â”œâ”€â”€ net.cmake
        â”œâ”€â”€ net.h
        â”œâ”€â”€ model.c
        â”œâ”€â”€ context.c
        â”œâ”€â”€ context.h
        â”œâ”€â”€ tensor.c
        â”œâ”€â”€ tensor.h
        â”œâ”€â”€ weight.c
        â””â”€â”€ weight.h
    ```

    è®­ç»ƒæ‰§è¡Œæµç¨‹æ¶‰åŠçš„APIè¯·å‚è€ƒ[è®­ç»ƒæ¥å£ä»‹ç»](#è®­ç»ƒä»£ç çš„è°ƒç”¨æ¥å£)

## `Micro`åº“è·å–

åœ¨ç”Ÿæˆæ¨¡å‹æ¨ç†ä»£ç ä¹‹åï¼Œç”¨æˆ·åœ¨å¯¹ä»£ç è¿›è¡Œé›†æˆå¼€å‘ä¹‹å‰ï¼Œéœ€è¦è·å¾—ç”Ÿæˆçš„æ¨ç†ä»£ç æ‰€ä¾èµ–çš„`Micro`åº“ã€‚

ä¸åŒå¹³å°çš„æ¨ç†ä»£ç ä¾èµ–å¯¹åº”å¹³å°çš„`Micro`åº“ï¼Œç”¨æˆ·éœ€æ ¹æ®ä½¿ç”¨çš„å¹³å°ï¼Œåœ¨ç”Ÿæˆä»£ç æ—¶ï¼Œé€šè¿‡Microé…ç½®é¡¹`target`æŒ‡å®šè¯¥å¹³å°ï¼Œå¹¶åœ¨è·å–`Micro`åº“æ—¶ï¼Œè·å¾—è¯¥å¹³å°çš„`Micro`åº“ã€‚
ç”¨æˆ·å¯é€šè¿‡MindSporeå®˜ç½‘ä¸‹è½½å¯¹åº”å¹³å°çš„[Releaseç‰ˆæœ¬](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/downloads.html)ã€‚

åœ¨[æ¨¡å‹æ¨ç†ä»£ç ç”Ÿæˆ](#æ¨¡å‹æ¨ç†ä»£ç ç”Ÿæˆ)ç« èŠ‚ï¼Œæˆ‘ä»¬å¾—åˆ°äº†x86_64æ¶æ„Linuxå¹³å°çš„æ¨¡å‹æ¨ç†ä»£ç ï¼Œè€Œè¯¥ä»£ç æ‰€ä¾èµ–çš„`Micro`åº“ï¼Œå°±åœ¨è½¬æ¢å·¥å…·æ‰€ä½¿ç”¨çš„å‘å¸ƒåŒ…å†…ã€‚
å‘å¸ƒåŒ…å†…ï¼Œæ¨ç†ä»£ç æ‰€ä¾èµ–çš„åº“å’Œå¤´æ–‡ä»¶å¦‚ä¸‹ï¼š

```text
mindspore-lite-{version}-linux-x64
â”œâ”€â”€ runtime
â”‚   â””â”€â”€ include
â”‚       â””â”€â”€ c_api            # MindSpore Liteé›†æˆå¼€å‘çš„C APIå¤´æ–‡ä»¶
â””â”€â”€ tools
    â””â”€â”€ codegen # ä»£ç ç”Ÿæˆçš„source code ä¾èµ–includeå’Œlib
        â”œâ”€â”€ include          # æ¨ç†æ¡†æ¶å¤´æ–‡ä»¶
        â”‚   â”œâ”€â”€ nnacl        # nnacl ç®—å­å¤´æ–‡ä»¶
        â”‚   â””â”€â”€ wrapper      # wrapper ç®—å­å¤´æ–‡ä»¶
        â”œâ”€â”€ lib
        â”‚   â”œâ”€â”€ libwrapper.a # MindSpore Lite codegenç”Ÿæˆä»£ç ä¾èµ–çš„éƒ¨åˆ†ç®—å­é™æ€åº“
        â”‚   â””â”€â”€ libnnacl.a   # MindSpore Lite codegenç”Ÿæˆä»£ç ä¾èµ–çš„nnaclç®—å­é™æ€åº“
        â””â”€â”€ third_party
            â”œâ”€â”€ include
            â”‚   â””â”€â”€ CMSIS    # ARM CMSIS NN ç®—å­å¤´æ–‡ä»¶
            â””â”€â”€ lib
                â””â”€â”€ libcmsis_nn.a # ARM CMSIS NN ç®—å­é™æ€åº“
```

## ä»£ç é›†æˆåŠç¼–è¯‘éƒ¨ç½²

åœ¨ç”Ÿæˆä»£ç çš„`benchmark`ç›®å½•ä¸­ï¼ŒåŒ…å«äº†å¯¹æ¨ç†ä»£ç çš„æ¥å£è°ƒç”¨ç¤ºä¾‹ï¼Œç”¨æˆ·å¯å‚è€ƒbenchmarkä¾‹ç¨‹ï¼Œæ¥å¯¹`src`æ¨ç†ä»£ç è¿›è¡Œé›†æˆå¼€å‘ä»¥å®ç°è‡ªèº«çš„åº”ç”¨ã€‚

### æ¨ç†ä»£ç çš„è°ƒç”¨æ¥å£

ä»¥ä¸‹æ˜¯æ¨ç†ä»£ç çš„ä¸€èˆ¬è°ƒç”¨æ¥å£ï¼Œå…³äºæ¥å£çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚è€ƒ[APIæ–‡æ¡£](https://www.mindspore.cn/lite/api/zh-CN/r2.0.0-alpha/index.html)ã€‚

è¡¨3ï¼šæ¨ç†é€šç”¨APIæ¥å£

| åŠŸèƒ½                  | å‡½æ•°åŸå‹                                                                                                                                                                    |
| --------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| åˆ›å»º Model            | MSModelHandle MSModelCreate()                                                                                                                                               |
| é”€æ¯ Model            | void MSModelDestroy(MSModelHandle *model)                                                                                                                                   |
| è®¡ç®— Model è¿è¡Œæ—¶æ‰€éœ€çš„ç¼“å­˜å¤§å°ï¼ˆä»…æ”¯æŒCortex-Må¹³å°)    | size_t MSModelCalcWorkspaceSize(MSModelHandle model)                       |
| è®¾ç½® Model è¿è¡Œæ—¶çš„ç¼“å­˜ï¼ˆä»…æ”¯æŒCortex-Må¹³å°)           | void MSModelSetWorkspace(MSModelHandle model, void *workspace, size_t workspace_size)                        |
| ç¼–è¯‘ Model           | MSStatus MSModelBuild(MSModelHandle model, const void *model_data, size_t data_size, MSModelType model_type, const MSContextHandle model_context)                           |
| æ¨ç† Model                 | MSStatus MSModelPredict(MSModelHandle model, const MSTensorHandleArray inputs, MSTensorHandleArray *outputs, const MSKernelCallBackC before, const MSKernelCallBackC after) |
| è·å–æ‰€æœ‰è¾“å…¥ Tensor   | MSTensorHandleArray MSModelGetInputs(const MSModelHandle model)                                                                                                             |
| è·å–æ‰€æœ‰è¾“å‡º Tensor   | MSTensorHandleArray MSModelGetOutputs(const MSModelHandle model)                                                                                                            |
| é€šè¿‡åå­—å–è¾“å…¥ Tensor | MSTensorHandle MSModelGetInputByTensorName(const MSModelHandle model, const char *tensor_name)                                                                              |
| é€šè¿‡åå­—å–è¾“å‡º Tensor | MSTensorHandle MSModelGetOutputByTensorName(const MSModelHandle model, const char *tensor_name)                                                                                                              |9

### è®­ç»ƒä»£ç çš„è°ƒç”¨æ¥å£

ä»¥ä¸‹æ˜¯è®­ç»ƒä»£ç çš„ä¸€èˆ¬è°ƒç”¨æ¥å£ã€‚

è¡¨4ï¼šè®­ç»ƒé€šç”¨APIæ¥å£(æ­¤å¤„åªåˆ—ä¸¾è®­ç»ƒç›¸å…³æ¥å£)

| åŠŸèƒ½                  | å‡½æ•°åŸå‹                                                                                                                                                                    |
| --------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| å•æ­¥æ‰§è¡Œ Model         | MSStatus MSModelRunStep(MSModelHandle model, const MSKernelCallBackC before, const MSKernelCallBackC after) |
| è®¾ç½®æ‰§è¡Œæ¨¡å¼ Model      | MSStatus MSModelSetTrainMode(MSModelHandle model, bool train) |
| æƒé‡å¯¼å‡º Model         | MSStatus MSModelExportWeight(MSModelHandle model,const char *export_path) |

### ä¸åŒçš„å¹³å°çš„é›†æˆå·®å¼‚

ä¸åŒçš„å¹³å°åœ¨ä»£ç é›†æˆå’Œç¼–è¯‘éƒ¨ç½²ä¸Šä¼šæœ‰ä¸åŒçš„å·®å¼‚ã€‚

- å¯¹äºcortex-Mæ¶æ„çš„MCUè¯·å‚è€ƒ[åœ¨MCUä¸Šæ‰§è¡Œæ¨ç†](#åœ¨mcuä¸Šæ‰§è¡Œæ¨ç†)

- å¯¹äºx86_64æ¶æ„Linuxå¹³å°ï¼Œè¯·å‚è€ƒ[Linux_x86_64å¹³å°ç¼–è¯‘éƒ¨ç½²](https://gitee.com/mindspore/mindspore/tree/r2.0.0-alpha/mindspore/lite/examples/quick_start_micro/mnist_x86)

- å¯¹äºarm32æˆ–arm64çš„Androidå¹³å°ç¼–è¯‘éƒ¨ç½²ï¼Œè¯·å‚è€ƒ[Androidå¹³å°ç¼–è¯‘éƒ¨ç½²](https://gitee.com/mindspore/mindspore/tree/r2.0.0-alpha/mindspore/lite/examples/quick_start_micro/mobilenetv2_arm64)

- å¯¹äºåœ¨OpenHarmonyå¹³å°ä¸Šç¼–è¯‘éƒ¨ç½²ï¼Œè¯·å‚è€ƒ[åœ¨è½»é¸¿è’™è®¾å¤‡ä¸Šæ‰§è¡Œæ¨ç†](#åœ¨è½»é¸¿è’™è®¾å¤‡ä¸Šæ‰§è¡Œæ¨ç†)

## åœ¨MCUä¸Šæ‰§è¡Œæ¨ç†

### æ¦‚è¿°

æœ¬æ•™ç¨‹ä»¥[MNISTæ¨¡å‹](https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/mnist.tar.gz)åœ¨STM32F767èŠ¯ç‰‡çš„éƒ¨ç½²ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•åœ¨Cortex-Mæ¶æ„çš„MCUä¸Šéƒ¨ç½²æ¨ç†æ¨¡å‹ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ æ­¥ï¼š

- é€šè¿‡converter_liteè½¬æ¢å·¥å…·ï¼Œç”Ÿæˆé€‚é…Cortex-Mæ¶æ„çš„æ¨¡å‹æ¨ç†ä»£ç 

- ä¸‹è½½å¾—åˆ°è¯¥Cortex-Mæ¶æ„å¯¹åº”çš„`Micro`åº“

- å¯¹å¾—åˆ°çš„æ¨ç†ä»£ç å’Œ`Micro`åº“è¿›è¡Œé›†æˆï¼Œç¼–è¯‘å¹¶éƒ¨ç½²éªŒè¯

    åœ¨Windowså¹³å°ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡IARè¿›è¡Œæ¨ç†ä»£ç çš„é›†æˆå¼€å‘ï¼Œåœ¨Linuxå¹³å°ä¸Šï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡MakeFileäº¤å‰ç¼–è¯‘çš„æ–¹å¼è¿›è¡Œä»£ç é›†æˆå¼€å‘ã€‚

### ç”ŸæˆMCUæ¨ç†ä»£ç 

ä¸ºMCUç”Ÿæˆæ¨ç†ä»£ç ï¼Œè¯·å‚è€ƒ[æ¨¡å‹æ¨ç†ä»£ç ç”Ÿæˆ](#æ¨¡å‹æ¨ç†ä»£ç ç”Ÿæˆ)ç« èŠ‚ï¼Œåªéœ€å°†Microé…ç½®é¡¹ä¸­çš„`target=x86`æ”¹ä¸º`target=Cortex-M`ï¼Œå°±å¯ä»¥ä¸ºMCUç”Ÿæˆæ¨ç†ä»£ç ã€‚
ç”ŸæˆæˆåŠŸä¹‹åï¼Œæ–‡ä»¶å¤¹å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š

```text
mnist                          # æŒ‡å®šçš„ç”Ÿæˆä»£ç æ ¹ç›®å½•åç§°
â”œâ”€â”€ benchmark                  # å¯¹æ¨¡å‹æ¨ç†ä»£ç è¿›è¡Œé›†æˆè°ƒç”¨çš„benchmarkä¾‹ç¨‹
â”‚   â”œâ”€â”€ benchmark.c
â”‚   â”œâ”€â”€ calib_output.c
â”‚   â”œâ”€â”€ calib_output.h
â”‚   â”œâ”€â”€ data.c
â”‚   â”œâ”€â”€ data.h
â”‚   â”œâ”€â”€ load_input.c
â”‚   â””â”€â”€ load_input.h
â”œâ”€â”€ build.sh                   # ä¸€é”®ç¼–è¯‘è„šæœ¬
â”œâ”€â”€ CMakeLists.txt             # benchmarkä¾‹ç¨‹çš„cmakeå·¥ç¨‹æ–‡ä»¶
â”œâ”€â”€ cortex-m7.toolchain.cmake  # cortex-m7çš„äº¤å‰ç¼–è¯‘cmakeæ–‡ä»¶
â””â”€â”€ src                        # æ¨¡å‹æ¨ç†ä»£ç ç›®å½•
    â”œâ”€â”€ CMakeLists.txt
    â”œâ”€â”€ context.c
    â”œâ”€â”€ context.h
    â”œâ”€â”€ model.c
    â”œâ”€â”€ net.c
    â”œâ”€â”€ net.cmake
    â”œâ”€â”€ net.h
    â”œâ”€â”€ tensor.c
    â”œâ”€â”€ tensor.h
    â”œâ”€â”€ weight.c
    â””â”€â”€ weight.h
```

### ä¸‹è½½Cortex-Mæ¶æ„`Micro`åº“

STM32F767èŠ¯ç‰‡ä¸ºCortex-M7æ¶æ„ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è·å–è¯¥æ¶æ„çš„`Micro`åº“ï¼š

- MindSporeå®˜ç½‘ä¸‹è½½[Releaseç‰ˆæœ¬](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/downloads.html)ã€‚

    ç”¨æˆ·éœ€ä¸‹è½½æ“ä½œç³»ç»Ÿä¸ºNoneï¼Œç¡¬ä»¶å¹³å°ä¸ºCortex-M7çš„å‘å¸ƒåŒ…ã€‚

- ä»æºç å¼€å§‹[ç¼–è¯‘æ„å»º](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/build.html)ã€‚

    ç”¨æˆ·å¯é€šè¿‡`MSLITE_MICRO_PLATFORM=cortex-m7 bash build.sh -I x86_64`å‘½ä»¤ï¼Œæ¥ç¼–è¯‘å¾—åˆ°`Cortex-M7`çš„å‘å¸ƒåŒ…ã€‚

å¯¹äºæš‚æœªæä¾›å‘å¸ƒåŒ…è¿›è¡Œä¸‹è½½çš„å…¶ä»–Cortex-Mæ¶æ„å¹³å°ï¼Œç”¨æˆ·å¯å‚è€ƒä»æºç ç¼–è¯‘æ„å»ºçš„æ–¹å¼ï¼Œä¿®æ”¹MindSporeæºç ï¼Œè¿›è¡Œæ‰‹åŠ¨ç¼–è¯‘ï¼Œå¾—åˆ°å‘å¸ƒåŒ…ã€‚

### åœ¨Windowsä¸Šçš„ä»£ç é›†æˆåŠç¼–è¯‘éƒ¨ç½²ï¼šé€šè¿‡IARè¿›è¡Œé›†æˆå¼€å‘

æœ¬ä¾‹é€šè¿‡IARè¿›è¡Œä»£ç é›†æˆåŠçƒ§å½•ï¼Œæ¼”ç¤ºå¦‚ä½•åœ¨Windowsä¸Šå¯¹ç”Ÿæˆçš„æ¨ç†ä»£ç è¿›è¡Œé›†æˆå¼€å‘ã€‚ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š

- ä¸‹è½½æ‰€éœ€è¦çš„ç›¸å…³è½¯ä»¶ï¼Œåšå¥½é›†æˆçš„ç¯å¢ƒå‡†å¤‡

- é€šè¿‡`STM32CubeMX`è½¯ä»¶ç”Ÿæˆæ‰€éœ€è¦çš„MCUå¯åŠ¨ä»£ç åŠæ¼”ç¤ºå·¥ç¨‹

- åœ¨`IAR`å†…é›†æˆæ¨¡å‹æ¨ç†ä»£ç åŠ`Micro`åº“

- ç¼–è¯‘å¹¶ä»¿çœŸè¿è¡Œ

#### ç¯å¢ƒå‡†å¤‡

- [STM32CubeMX Windowsç‰ˆæœ¬](https://www.st.com/en/development-tools/stm32cubemx.html) >= 6.0.1

    - `STM32CubeMX`æ˜¯`æ„æ³•åŠå¯¼ä½“`æä¾›çš„STM32èŠ¯ç‰‡å›¾å½¢åŒ–é…ç½®å·¥å…·ï¼Œè¯¥å·¥å…·ç”¨äºç”ŸæˆSTMèŠ¯ç‰‡çš„å¯åŠ¨ä»£ç åŠå·¥ç¨‹ã€‚

- [IAR EWARM](https://www.iar.com/ewarm) >= 9.1

    - `IAR EWARM`æ˜¯ä¸€æ¬¾IARSystemså…¬å¸ä¸ºARMå¾®å¤„ç†å™¨å¼€å‘çš„ä¸€ä¸ªé›†æˆå¼€å‘ç¯å¢ƒã€‚

#### è·å–MCUå¯åŠ¨ä»£ç åŠå·¥ç¨‹

å¦‚æœç”¨æˆ·å·²ç»æœ‰è‡ªå·±çš„MCUå·¥ç¨‹ï¼Œè¯·å¿½ç•¥è¯¥ç« èŠ‚ã€‚
æœ¬ç« ï¼Œä»¥ç”ŸæˆSTM32F767èŠ¯ç‰‡çš„å¯åŠ¨å·¥ç¨‹ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•é€šè¿‡`STM32CubeMX`ç”ŸæˆSTM32èŠ¯ç‰‡çš„MCUå·¥ç¨‹ã€‚

- å¯åŠ¨`STM32CubeMX`ï¼Œåœ¨`File`é€‰é¡¹ä¸­é€‰æ‹©`New Project`æ¥æ–°å»ºå·¥ç¨‹ã€‚

- åœ¨`MCU/MPU Selector`çª—å£ï¼Œæœç´¢å¹¶é€‰æ‹©`STM32F767IGT6`ï¼Œç‚¹å‡»`Start Project`åˆ›å»ºè¯¥èŠ¯ç‰‡çš„å·¥ç¨‹ã€‚

- åœ¨`Project Manager`ç•Œé¢ï¼Œé…ç½®å·¥ç¨‹ååŠç”Ÿæˆçš„å·¥ç¨‹è·¯å¾„ï¼Œåœ¨`Toolchain / IDE`é€‰é¡¹é€‰æ‹©`EWARM`ï¼Œä»¥æŒ‡å®šç”ŸæˆIARå·¥ç¨‹ã€‚

- ç‚¹å‡»ä¸Šæ–¹çš„`GENERATE CODE`ç”Ÿæˆä»£ç ã€‚

- åœ¨å·²å®‰è£…`IAR`çš„PCæœºä¸Šï¼ŒåŒå‡»ç”Ÿæˆå·¥ç¨‹å†…`EWARM`ç›®å½•ä¸‹çš„`Project.eww`å³å¯æ‰“å¼€è¯¥IARå·¥ç¨‹ã€‚

#### é›†æˆæ¨¡å‹æ¨ç†ä»£ç åŠ`Micro`åº“

- å°†ç”Ÿæˆçš„æ¨ç†ä»£ç æ‹·è´åˆ°å·¥ç¨‹å†…ï¼Œå¹¶å°†[ä¸‹è½½Cortex-Mæ¶æ„`Micro`åº“](#ä¸‹è½½cortex-mæ¶æ„microåº“)ç« èŠ‚è·å¾—çš„å‹ç¼©åŒ…è§£å‹åæ”¾åˆ°ç”Ÿæˆçš„æ¨ç†ä»£ç ç›®å½•å†…ï¼Œç›®å½•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

    ```text
    test_stm32f767                                   # MCUå·¥ç¨‹ç›®å½•
    â”œâ”€â”€ Core
    â”‚Â Â  â”œâ”€â”€ Inc
    â”‚Â Â  â””â”€â”€ Src
    â”‚       â”œâ”€â”€ main.c
    â”‚       â””â”€â”€ ...
    â”œâ”€â”€ Drivers
    â”œâ”€â”€ EWARM                                        # IARå·¥ç¨‹æ–‡ä»¶ç›®å½•
    â””â”€â”€ mnist                                        # ç”Ÿæˆä»£ç æ ¹ç›®å½•
     Â Â  â”œâ”€â”€ benchmark                                # å¯¹æ¨¡å‹æ¨ç†ä»£ç è¿›è¡Œé›†æˆè°ƒç”¨çš„benchmarkä¾‹ç¨‹
        â”‚   â”œâ”€â”€ benchmark.c
        â”‚   â”œâ”€â”€ data.c
        â”‚   â”œâ”€â”€ data.h
        â”‚   â””â”€â”€ ...
        â”‚â”€â”€ mindspore-lite-1.8.0-none-cortex-m7      # ä¸‹è½½çš„Cortex-M7æ¶æ„`Micro`åº“
        â”œâ”€â”€ src                                      # æ¨¡å‹æ¨ç†ä»£ç ç›®å½•
     Â Â  â””â”€â”€ ...
    ```

- å‘IARå·¥ç¨‹å¯¼å…¥æºæ–‡ä»¶

    æ‰“å¼€IARå·¥ç¨‹ï¼Œåœ¨`Workspace`ç•Œé¢ï¼Œå³é”®è¯¥é¡¹ç›®ï¼Œé€‰æ‹©`Add -> Add Group`ï¼Œæ·»åŠ ä¸€ä¸ª`mnist`åˆ†ç»„ï¼Œå³é”®ç‚¹å‡»è¯¥åˆ†ç»„ï¼Œé‡å¤æ–°å»ºåˆ†ç»„æ“ä½œï¼Œæ–°å»º`src`å’Œ`benchmark`åˆ†ç»„ã€‚
    åœ¨å„è‡ªåˆ†ç»„ä¸‹ï¼Œé€‰æ‹©`Add -> Add Files`ï¼Œå°†`mnist`æ–‡ä»¶å¤¹å†…`src`å’Œ`benchmark`ç›®å½•ä¸‹çš„æºæ–‡ä»¶å¼•å…¥å„è‡ªåˆ†ç»„ã€‚

- åŠ å…¥ä¾èµ–çš„å¤´æ–‡ä»¶è·¯å¾„å’Œé™æ€åº“

    åœ¨`Workspace`ç•Œé¢ï¼Œå³é”®è¯¥é¡¹ç›®ï¼Œé€‰æ‹©`Options`ï¼Œæ‰“å¼€é¡¹ç›®é€‰é¡¹çª—å£ã€‚åœ¨é¡¹ç›®é€‰é¡¹çª—å£å·¦ä¾§é€‰æ‹©`C/C++ Compiler`é€‰é¡¹ï¼Œåœ¨å³ä¾§çš„å­çª—å£ä¸­ï¼Œé€‰æ‹©`Preprocessor`å­ç•Œé¢ï¼Œå°†æ¨ç†ä»£ç ä¾èµ–çš„å¤´æ–‡ä»¶è·¯å¾„åŠ å…¥åˆ°åˆ—è¡¨ä¸­ã€‚æœ¬ä¾‹ä¸­æ·»åŠ çš„å¤´æ–‡ä»¶è·¯å¾„å¦‚ä¸‹ï¼š

    ```text
    $PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/runtime
    $PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/runtime/include
    $PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/include
    $PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/third_party/include/CMSIS/Core
    $PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/third_party/include/CMSIS/DSP
    $PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/third_party/include/CMSIS/NN
    $PROJ_DIR$/../mnist
    ```

    åœ¨é¡¹ç›®é€‰é¡¹çª—å£å·¦ä¾§é€‰æ‹©`Linker`é€‰é¡¹ï¼Œåœ¨å³ä¾§çš„å­çª—å£ä¸­ï¼Œé€‰æ‹©`Library`å­ç•Œé¢ï¼Œå°†æ¨ç†ä»£ç ä¾èµ–çš„ç®—å­é™æ€åº“æ–‡ä»¶åŠ å…¥åˆ°åˆ—è¡¨ä¸­ã€‚æœ¬ä¾‹ä¸­æ·»åŠ çš„é™æ€åº“æ–‡ä»¶å¦‚ä¸‹ï¼š

    ```text
    $PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/lib/libwrapper.a
    $PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/lib/libnnacl.a
    $PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/third_party/lib/libcmsis_nn.a  
    ```

- ä¿®æ”¹main.cæ–‡ä»¶ï¼Œè°ƒç”¨benchmarkå‡½æ•°

    åœ¨`main.c`å¼€å¤´å¢åŠ å¤´æ–‡ä»¶å¼•ç”¨ï¼Œå¹¶åœ¨mainå‡½æ•°ä¸­è°ƒç”¨`benchmark.c`ä¸­çš„`benchmark`å‡½æ•°ï¼Œbenchmarkæ–‡ä»¶å¤¹å†…çš„ç¨‹åºä¸ºå¯¹ç”Ÿæˆçš„`src`å†…çš„æ¨ç†ä»£ç è¿›è¡Œæ¨ç†è°ƒç”¨å¹¶æ¯”è¾ƒè¾“å‡ºçš„ç¤ºèŒƒæ ·ä¾‹ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥è‡ªç”±å¯¹å®ƒè¿›è¡Œä¿®æ”¹ã€‚

    ```c++
    #include "benchmark/benchmark.h"
    ...
    int main(void)
    {
      ...
      if (benchmark() == 0) {
          printf("\nrun success.\n");
      } else {
          printf("\nrun failed.\n");
      }
      ...
    }
    ```

- ä¿®æ”¹`mnist/benchmark/data.c`æ–‡ä»¶ï¼Œå°†æ ‡æ†è¾“å…¥è¾“å‡ºæ•°æ®å­˜æ”¾åœ¨ç¨‹åºå†…ä»¥è¿›è¡Œå¯¹æ¯”

    åœ¨benchmarkä¾‹ç¨‹å†…ï¼Œä¼šè®¾ç½®æ¨¡å‹çš„è¾“å…¥æ•°æ®ï¼Œå¹¶å°†æ¨ç†ç»“æœå’Œè®¾å®šçš„æœŸæœ›ç»“æœè¿›è¡Œå¯¹æ¯”ï¼Œå¾—åˆ°è¯¯å·®åç§»å€¼ã€‚
    åœ¨æœ¬ä¾‹ä¸­ï¼Œé€šè¿‡ä¿®æ”¹`data.c`çš„`calib_input0_data`æ•°ç»„ï¼Œè®¾ç½®æ¨¡å‹çš„è¾“å…¥æ•°æ®ï¼Œé€šè¿‡ä¿®æ”¹`calib_output0_data`ï¼Œè®¾å®šæœŸæœ›ç»“æœã€‚

    ```c++
    float calib_input0_data[NET_INPUT0_SIZE] = {0.54881352186203,0.7151893377304077,0.6027633547782898,0.5448831915855408,0.42365479469299316,0.6458941102027893,0.4375872015953064,0.891772985458374,0.9636627435684204,0.3834415078163147,0.7917250394821167,0.5288949012756348,0.5680445432662964,0.9255966544151306,0.07103605568408966,0.08712930232286453,0.020218396559357643,0.832619845867157,0.7781567573547363,0.8700121641159058,0.978618323802948,0.7991585731506348,0.4614793658256531,0.7805292010307312,0.11827442795038223,0.6399210095405579,0.14335328340530396,0.9446688890457153,0.5218483209609985,0.4146619439125061,0.26455560326576233,0.7742336988449097,0.4561503231525421,0.568433940410614,0.018789799883961678,0.6176354885101318,0.6120957136154175,0.6169340014457703,0.9437480568885803,0.681820273399353,0.35950788855552673,0.43703195452690125,0.6976311802864075,0.0602254718542099,0.6667667031288147,0.670637845993042,0.21038256585597992,0.12892629206180573,0.31542834639549255,0.36371076107025146,0.5701967477798462,0.4386015236377716,0.9883738160133362,0.10204481333494186,0.20887675881385803,0.16130951046943665,0.6531082987785339,0.25329160690307617,0.4663107693195343,0.24442559480667114,0.15896958112716675,0.11037514358758926,0.6563295722007751,0.13818295300006866,0.1965823620557785,0.3687251806259155,0.8209932446479797,0.09710127860307693,0.8379449248313904,0.0960984081029892,0.9764594435691833,0.4686512053012848,0.9767611026763916,0.6048455238342285,0.7392635941505432,0.03918779268860817,0.28280696272850037,0.12019655853509903,0.296140193939209,0.11872772127389908,0.3179831802845001,0.414262980222702,0.06414749473333359,0.6924721002578735,0.5666014552116394,0.26538950204849243,0.5232480764389038,0.09394051134586334,0.5759465098381042,0.9292961955070496,0.3185689449310303,0.6674103736877441,0.13179786503314972,0.7163271903991699,0.28940609097480774,0.18319135904312134,0.5865129232406616,0.02010754682123661,0.8289400339126587,0.004695476032793522,0.6778165102005005,0.2700079679489136,0.7351940274238586,0.9621885418891907,0.2487531453371048,0.5761573314666748,0.5920419096946716,0.5722519159317017,0.22308163344860077,0.9527490139007568,0.4471253752708435,0.8464086651802063,0.6994792819023132,0.2974369525909424,0.8137978315353394,0.396505743265152,0.8811032176017761,0.5812729001045227,0.8817353844642639,0.6925315856933594,0.7252542972564697,0.5013243556022644,0.9560836553573608,0.6439902186393738,0.4238550364971161,0.6063932180404663,0.019193198531866074,0.30157482624053955,0.6601735353469849,0.2900775969028473,0.6180154085159302,0.42876869440078735,0.1354740709066391,0.29828232526779175,0.5699648857116699,0.5908727645874023,0.5743252635002136,0.6532008051872253,0.6521032452583313,0.43141844868659973,0.8965466022491455,0.36756187677383423,0.4358649253845215,0.8919233679771423,0.806194007396698,0.7038885951042175,0.10022688657045364,0.9194825887680054,0.7142413258552551,0.9988470077514648,0.14944830536842346,0.8681260347366333,0.16249293088912964,0.6155595779418945,0.1238199844956398,0.8480082154273987,0.8073189854621887,0.5691007375717163,0.40718328952789307,0.06916699558496475,0.6974287629127502,0.45354267954826355,0.7220556139945984,0.8663823008537292,0.9755215048789978,0.855803370475769,0.011714084073901176,0.359978049993515,0.729990541934967,0.17162968218326569,0.5210366249084473,0.054337989538908005,0.19999653100967407,0.01852179504930973,0.793697714805603,0.2239246815443039,0.3453516662120819,0.9280812740325928,0.704414427280426,0.031838931143283844,0.1646941602230072,0.6214783787727356,0.5772286057472229,0.23789282143115997,0.9342139959335327,0.6139659285545349,0.5356327891349792,0.5899099707603455,0.7301220297813416,0.31194499135017395,0.39822107553482056,0.20984375476837158,0.18619300425052643,0.9443724155426025,0.739550769329071,0.49045881628990173,0.22741462290287018,0.2543564736843109,0.058029159903526306,0.43441662192344666,0.3117958903312683,0.6963434815406799,0.37775182723999023,0.1796036809682846,0.024678727611899376,0.06724963337182999,0.6793927550315857,0.4536968469619751,0.5365791916847229,0.8966712951660156,0.990338921546936,0.21689698100090027,0.6630781888961792,0.2633223831653595,0.02065099962055683,0.7583786249160767,0.32001715898513794,0.38346388936042786,0.5883170962333679,0.8310484290122986,0.6289818286895752,0.872650682926178,0.27354204654693604,0.7980468273162842,0.18563593924045563,0.9527916312217712,0.6874882578849792,0.21550767123699188,0.9473705887794495,0.7308558225631714,0.2539416551589966,0.21331197023391724,0.518200695514679,0.02566271834075451,0.20747007429599762,0.4246854782104492,0.3741699755191803,0.46357542276382446,0.27762871980667114,0.5867843627929688,0.8638556003570557,0.11753185838460922,0.517379105091095,0.13206811249256134,0.7168596982955933,0.39605969190597534,0.5654212832450867,0.1832798421382904,0.14484776556491852,0.4880562722682953,0.35561272501945496,0.9404319524765015,0.7653252482414246,0.748663604259491,0.9037197232246399,0.08342243731021881,0.5521924495697021,0.5844760537147522,0.961936354637146,0.29214751720428467,0.24082878232002258,0.10029394179582596,0.016429629176855087,0.9295293092727661,0.669916570186615,0.7851529121398926,0.28173011541366577,0.5864101648330688,0.06395526975393295,0.48562759160995483,0.9774951338768005,0.8765052556991577,0.3381589651107788,0.961570143699646,0.23170162737369537,0.9493188261985779,0.9413776993751526,0.799202561378479,0.6304479241371155,0.8742879629135132,0.2930202782154083,0.8489435315132141,0.6178767085075378,0.013236857950687408,0.34723350405693054,0.14814086258411407,0.9818294048309326,0.4783703088760376,0.49739137291908264,0.6394725441932678,0.36858460307121277,0.13690027594566345,0.8221177458763123,0.1898479163646698,0.5113189816474915,0.2243170291185379,0.09784448146820068,0.8621914982795715,0.9729194641113281,0.9608346819877625,0.9065554738044739,0.774047315120697,0.3331451416015625,0.08110138773918152,0.40724116563796997,0.2322341352701187,0.13248763978481293,0.053427182137966156,0.7255943417549133,0.011427458375692368,0.7705807685852051,0.14694663882255554,0.07952208071947098,0.08960303664207458,0.6720477938652039,0.24536721408367157,0.4205394685268402,0.557368814945221,0.8605511784553528,0.7270442843437195,0.2703278958797455,0.131482794880867,0.05537432059645653,0.3015986382961273,0.2621181607246399,0.45614057779312134,0.6832813620567322,0.6956254243850708,0.28351885080337524,0.3799269497394562,0.18115095794200897,0.7885454893112183,0.05684807524085045,0.6969972252845764,0.7786954045295715,0.7774075865745544,0.25942257046699524,0.3738131523132324,0.5875996351242065,0.27282190322875977,0.3708527982234955,0.19705428183078766,0.4598558843135834,0.044612299650907516,0.7997958660125732,0.07695644348859787,0.5188351273536682,0.3068101108074188,0.5775429606437683,0.9594333171844482,0.6455702185630798,0.03536243736743927,0.4304024279117584,0.5100168585777283,0.5361775159835815,0.6813924908638,0.2775960862636566,0.12886056303977966,0.3926756680011749,0.9564056992530823,0.1871308982372284,0.9039839506149292,0.5438059568405151,0.4569114148616791,0.8820413947105408,0.45860394835472107,0.7241676449775696,0.3990253210067749,0.9040443897247314,0.6900250315666199,0.6996220350265503,0.32772040367126465,0.7567786574363708,0.6360610723495483,0.2400202751159668,0.16053882241249084,0.796391487121582,0.9591665863990784,0.4581388235092163,0.5909841656684875,0.8577226400375366,0.45722344517707825,0.9518744945526123,0.5757511854171753,0.8207671046257019,0.9088436961174011,0.8155238032341003,0.15941447019577026,0.6288984417915344,0.39843425154685974,0.06271295249462128,0.4240322411060333,0.25868406891822815,0.849038302898407,0.03330462798476219,0.9589827060699463,0.35536885261535645,0.3567068874835968,0.01632850244641304,0.18523232638835907,0.40125951170921326,0.9292914271354675,0.0996149331331253,0.9453015327453613,0.869488537311554,0.4541623890399933,0.326700896024704,0.23274412751197815,0.6144647002220154,0.03307459130883217,0.015606064349412918,0.428795725107193,0.06807407736778259,0.2519409954547882,0.2211609184741974,0.253191202878952,0.13105523586273193,0.012036222964525223,0.11548429727554321,0.6184802651405334,0.9742562174797058,0.9903450012207031,0.40905410051345825,0.1629544198513031,0.6387617588043213,0.4903053343296051,0.9894098043441772,0.06530420482158661,0.7832344174385071,0.28839850425720215,0.24141861498355865,0.6625045537948608,0.24606318771839142,0.6658591032028198,0.5173085331916809,0.4240889847278595,0.5546877980232239,0.2870515286922455,0.7065746784210205,0.414856880903244,0.3605455458164215,0.8286569118499756,0.9249669313430786,0.04600730910897255,0.2326269894838333,0.34851935505867004,0.8149664998054504,0.9854914546012878,0.9689717292785645,0.904948353767395,0.2965562641620636,0.9920112490653992,0.24942004680633545,0.10590615123510361,0.9509525895118713,0.2334202527999878,0.6897682547569275,0.05835635960102081,0.7307090759277344,0.8817201852798462,0.27243688702583313,0.3790569007396698,0.3742961883544922,0.7487882375717163,0.2378072440624237,0.17185309529304504,0.4492916464805603,0.30446839332580566,0.8391891121864319,0.23774182796478271,0.5023894309997559,0.9425836205482483,0.6339976787567139,0.8672894239425659,0.940209686756134,0.7507648468017578,0.6995750665664673,0.9679655432701111,0.9944007992744446,0.4518216848373413,0.07086978107690811,0.29279401898384094,0.15235470235347748,0.41748636960983276,0.13128933310508728,0.6041178107261658,0.38280805945396423,0.8953858613967896,0.96779465675354,0.5468848943710327,0.2748235762119293,0.5922304391860962,0.8967611789703369,0.40673333406448364,0.5520782470703125,0.2716527581214905,0.4554441571235657,0.4017135500907898,0.24841345846652985,0.5058664083480835,0.31038081645965576,0.37303486466407776,0.5249704718589783,0.7505950331687927,0.3335074782371521,0.9241587519645691,0.8623185753822327,0.048690296709537506,0.2536425292491913,0.4461355209350586,0.10462789237499237,0.34847599267959595,0.7400975227355957,0.6805144548416138,0.6223844289779663,0.7105283737182617,0.20492368936538696,0.3416981101036072,0.676242470741272,0.879234790802002,0.5436780452728271,0.2826996445655823,0.030235258862376213,0.7103368043899536,0.007884103804826736,0.37267908453941345,0.5305371880531311,0.922111451625824,0.08949454873800278,0.40594232082366943,0.024313200265169144,0.3426109850406647,0.6222310662269592,0.2790679335594177,0.2097499519586563,0.11570323258638382,0.5771402716636658,0.6952700018882751,0.6719571352005005,0.9488610029220581,0.002703213831409812,0.6471966505050659,0.60039222240448,0.5887396335601807,0.9627703428268433,0.016871673986315727,0.6964824199676514,0.8136786222457886,0.5098071694374084,0.33396488428115845,0.7908401489257812,0.09724292904138565,0.44203564524650574,0.5199523568153381,0.6939564347267151,0.09088572859764099,0.2277594953775406,0.4103015661239624,0.6232946515083313,0.8869608044624329,0.618826150894165,0.13346147537231445,0.9805801510810852,0.8717857599258423,0.5027207732200623,0.9223479628562927,0.5413808226585388,0.9233060479164124,0.8298973441123962,0.968286395072937,0.919782817363739,0.03603381663560867,0.1747720092535019,0.3891346752643585,0.9521427154541016,0.300028920173645,0.16046763956546783,0.8863046765327454,0.4463944137096405,0.9078755974769592,0.16023047268390656,0.6611174941062927,0.4402637481689453,0.07648676633834839,0.6964631676673889,0.2473987489938736,0.03961552307009697,0.05994429811835289,0.06107853725552559,0.9077329635620117,0.7398838996887207,0.8980623483657837,0.6725823283195496,0.5289399027824402,0.30444636940956116,0.997962236404419,0.36218905448913574,0.47064894437789917,0.37824517488479614,0.979526937007904,0.1746583878993988,0.32798799872398376,0.6803486943244934,0.06320761889219284,0.60724937915802,0.47764649987220764,0.2839999794960022,0.2384132742881775,0.5145127177238464,0.36792758107185364,0.4565199017524719,0.3374773859977722,0.9704936742782593,0.13343943655490875,0.09680395573377609,0.3433917164802551,0.5910269021987915,0.6591764688491821,0.3972567617893219,0.9992780089378357,0.35189300775527954,0.7214066386222839,0.6375827193260193,0.8130538463592529,0.9762256741523743,0.8897936344146729,0.7645619511604309,0.6982485055923462,0.335498183965683,0.14768557250499725,0.06263600289821625,0.2419017106294632,0.432281494140625,0.521996259689331,0.7730835676193237,0.9587409496307373,0.1173204779624939,0.10700414329767227,0.5896947383880615,0.7453980445861816,0.848150372505188,0.9358320832252502,0.9834262132644653,0.39980170130729675,0.3803351819515228,0.14780867099761963,0.6849344372749329,0.6567619442939758,0.8620625734329224,0.09725799411535263,0.49777689576148987,0.5810819268226624,0.2415570467710495,0.16902540624141693,0.8595808148384094,0.05853492394089699,0.47062090039253235,0.11583399772644043,0.45705875754356384,0.9799623489379883,0.4237063527107239,0.857124924659729,0.11731556057929993,0.2712520658969879,0.40379273891448975,0.39981213212013245,0.6713835000991821,0.3447181284427643,0.713766872882843,0.6391869187355042,0.399161159992218,0.43176013231277466,0.614527702331543,0.0700421929359436,0.8224067091941833,0.65342116355896,0.7263424396514893,0.5369229912757874,0.11047711223363876,0.4050356149673462,0.40537357330322266,0.3210429847240448,0.029950324445962906,0.73725426197052,0.10978446155786514,0.6063081622123718,0.7032175064086914,0.6347863078117371,0.95914226770401,0.10329815745353699,0.8671671748161316,0.02919023483991623,0.534916877746582,0.4042436182498932,0.5241838693618774,0.36509987711906433,0.19056691229343414,0.01912289671599865,0.5181497931480408,0.8427768349647522,0.3732159435749054,0.2228638231754303,0.080532006919384,0.0853109210729599,0.22139644622802734,0.10001406073570251,0.26503971219062805,0.06614946573972702,0.06560486555099487,0.8562761545181274,0.1621202677488327,0.5596824288368225,0.7734555602073669,0.4564095735549927,0.15336887538433075,0.19959613680839539,0.43298420310020447,0.52823406457901,0.3494403064250946,0.7814795970916748,0.7510216236114502,0.9272118210792542,0.028952548280358315,0.8956912755966187,0.39256879687309265,0.8783724904060364,0.690784752368927,0.987348735332489,0.7592824697494507,0.3645446300506592,0.5010631680488586,0.37638914585113525,0.364911824464798,0.2609044909477234,0.49597030878067017,0.6817399263381958,0.27734026312828064,0.5243797898292542,0.117380291223526,0.1598452925682068,0.04680635407567024,0.9707314372062683,0.0038603513967245817,0.17857997119426727,0.6128667593002319,0.08136960119009018,0.8818964958190918,0.7196201682090759,0.9663899540901184,0.5076355338096619,0.3004036843776703,0.549500584602356,0.9308187365531921,0.5207614302635193,0.2672070264816284,0.8773987889289856,0.3719187378883362,0.0013833499979227781,0.2476850152015686,0.31823351979255676,0.8587774634361267,0.4585031569004059,0.4445872902870178,0.33610227704048157,0.880678117275238,0.9450267553329468,0.9918903112411499,0.3767412602901459,0.9661474227905273,0.7918795943260193,0.675689160823822,0.24488948285579681,0.21645726263523102,0.1660478264093399,0.9227566123008728,0.2940766513347626,0.4530942440032959,0.49395784735679626,0.7781715989112854,0.8442349433898926,0.1390727013349533,0.4269043505191803,0.842854917049408,0.8180332779884338};
    float calib_output0_data[NET_OUTPUT0_SIZE] = {3.5647096e-05,6.824297e-08,0.009327697,3.2340475e-05,1.1117579e-05,1.5117058e-06,4.6314454e-07,5.161628e-11,0.9905911,3.8835238e-10};
    ```

#### ç¼–è¯‘å¹¶ä»¿çœŸè¿è¡Œ

åœ¨æœ¬ä¾‹ä¸­ï¼Œé‡‡ç”¨è½¯ä»¶ä»¿çœŸçš„æ–¹å¼å¯¹æ¨ç†ç»“æœè¿›è¡ŒæŸ¥çœ‹åˆ†æã€‚
åœ¨`Workspace`ç•Œé¢ï¼Œå³é”®è¯¥é¡¹ç›®ï¼Œé€‰æ‹©`Options`ï¼Œæ‰“å¼€é¡¹ç›®é€‰é¡¹çª—å£ã€‚åœ¨é¡¹ç›®é€‰é¡¹çª—å£å·¦ä¾§é€‰æ‹©`Debugger`é€‰é¡¹ï¼Œåœ¨å³ä¾§çš„`Setup`å­çª—å£ä¸­ï¼Œ`Driver`é€‰æ‹©ä¸º`Simulator`ï¼Œä½¿èƒ½è½¯ä»¶ä»¿çœŸã€‚

å…³é—­é¡¹ç›®é€‰é¡¹çª—å£ï¼Œç‚¹å‡»èœå•æ `Project -> Download and Debug`ï¼Œè¿›è¡Œé¡¹ç›®ç¼–è¯‘å¹¶ä»¿çœŸã€‚é€šè¿‡åœ¨`benchmark`è°ƒç”¨å¤„åŠ å…¥æ–­ç‚¹ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°ä»¿çœŸè¿è¡Œçš„æ¨ç†ç»“æœï¼Œä»¥åŠbenchmark()å‡½æ•°çš„è¿”å›å€¼ã€‚

### åœ¨Linuxä¸Šçš„ä»£ç é›†æˆåŠç¼–è¯‘éƒ¨ç½²ï¼šé€šè¿‡MakeFileè¿›è¡Œä»£ç é›†æˆ

æœ¬ç« æ•™ç¨‹ä»¥åœ¨Linuxå¹³å°ä¸Šï¼Œé€šè¿‡MakeFileå¯¹ç”Ÿæˆçš„æ¨¡å‹ä»£ç è¿›è¡Œé›†æˆå¼€å‘ä¸ºä¾‹ï¼Œæ¼”ç¤ºäº†åœ¨Linuxä¸Šè¿›è¡ŒMCUæ¨ç†ä»£ç é›†æˆå¼€å‘çš„ä¸€èˆ¬æ­¥éª¤ã€‚
ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š

- ä¸‹è½½æ‰€éœ€è¦çš„ç›¸å…³è½¯ä»¶ï¼Œå‡†å¤‡å¥½äº¤å‰ç¼–è¯‘åŠçƒ§å½•ç¯å¢ƒ

- é€šè¿‡`STM32CubeMX`è½¯ä»¶ç”Ÿæˆæ‰€éœ€è¦çš„MCUå¯åŠ¨ä»£ç åŠæ¼”ç¤ºå·¥ç¨‹

- ä¿®æ”¹`MakeFile`é›†æˆæ¨¡å‹æ¨ç†ä»£ç åŠ`Micro`åº“

- ç¼–è¯‘å·¥ç¨‹åŠçƒ§å½•

- è¯»å–æ¿ç«¯è¿è¡Œç»“æœå¹¶éªŒè¯

æœ¬ä¾‹æ„å»ºå®Œæˆçš„å®Œæ•´demoä»£ç ï¼Œå¯ç‚¹å‡»[æ­¤å¤„ä¸‹è½½](https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/test_stmf767.tar.gz)ã€‚

#### ç¯å¢ƒå‡†å¤‡

- [CMake](https://cmake.org/download/) >= 3.18.3

- [GNU Arm Embedded Toolchain](https://developer.arm.com/downloads/-/gnu-rm)  >= 10-2020-q4-major-x86_64-linux

    - è¯¥å·¥å…·ä¸ºé€‚ç”¨Cortex-Mçš„Linuxä¸‹äº¤å‰ç¼–è¯‘å·¥å…·ã€‚
    - ä¸‹è½½x86_64-linuxç‰ˆæœ¬çš„`gcc-arm-none-eabi`ï¼Œè§£å‹ç¼©åï¼Œå°†ç›®å½•ä¸‹çš„binè·¯å¾„åŠ å…¥åˆ°PATHç¯å¢ƒå˜é‡ä¸­ï¼š`export PATH=gcc-arm-none-eabiè·¯å¾„/bin:$PATH`ã€‚

- [STM32CubeMX-Lin](https://www.st.com/en/development-tools/stm32cubemx.html) >= 6.5.0

    - `STM32CubeMX`æ˜¯`æ„æ³•åŠå¯¼ä½“`æä¾›çš„STM32èŠ¯ç‰‡å›¾å½¢åŒ–é…ç½®å·¥å…·ï¼Œè¯¥å·¥å…·ç”¨äºç”ŸæˆSTMèŠ¯ç‰‡çš„å¯åŠ¨ä»£ç åŠå·¥ç¨‹ã€‚

- [STM32CubePrg-Lin](https://www.st.com/en/development-tools/stm32cubeprog.html) >= 6.5.0

    - è¯¥å·¥å…·æ˜¯`æ„æ³•åŠå¯¼ä½“`æä¾›çš„çƒ§å½•å·¥å…·ï¼Œå¯ç”¨äºç¨‹åºçƒ§å½•å’Œæ•°æ®è¯»å–ã€‚

#### è·å–MCUå¯åŠ¨ä»£ç åŠå·¥ç¨‹

å¦‚æœç”¨æˆ·å·²ç»æœ‰è‡ªå·±çš„MCUå·¥ç¨‹ï¼Œè¯·å¿½ç•¥è¯¥ç« èŠ‚ã€‚
æœ¬ç« ï¼Œä»¥ç”ŸæˆSTM32F767èŠ¯ç‰‡çš„å¯åŠ¨å·¥ç¨‹ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•é€šè¿‡`STM32CubeMX`ç”ŸæˆSTM32èŠ¯ç‰‡çš„MCUå·¥ç¨‹ã€‚

- å¯åŠ¨`STM32CubeMX`ï¼Œåœ¨`File`é€‰é¡¹ä¸­é€‰æ‹©`New Project`æ¥æ–°å»ºå·¥ç¨‹ã€‚

- åœ¨`MCU/MPU Selector`çª—å£ï¼Œæœç´¢å¹¶é€‰æ‹©`STM32F767IGT6`ï¼Œç‚¹å‡»`Start Project`åˆ›å»ºè¯¥èŠ¯ç‰‡çš„å·¥ç¨‹ã€‚

- åœ¨`Project Manager`ç•Œé¢ï¼Œé…ç½®å·¥ç¨‹ååŠç”Ÿæˆçš„å·¥ç¨‹è·¯å¾„ï¼Œåœ¨`Toolchain / IDE`é€‰é¡¹é€‰æ‹©`Makefile`ï¼Œä»¥ğŸ‘ˆæŒ‡å®šç”Ÿæˆ`MakeFile`å·¥ç¨‹ã€‚

- ç‚¹å‡»ä¸Šæ–¹çš„`GENERATE CODE`ç”Ÿæˆä»£ç 

- åœ¨ç”Ÿæˆçš„å·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œ`make`ï¼Œæµ‹è¯•ä»£ç æ˜¯å¦æˆåŠŸç¼–è¯‘ã€‚

#### é›†æˆæ¨¡å‹æ¨ç†ä»£ç 

- å°†ç”Ÿæˆçš„æ¨ç†ä»£ç æ‹·è´åˆ°MCUå·¥ç¨‹å†…ï¼Œå¹¶å°†[ä¸‹è½½Cortex-Mæ¶æ„`Micro`åº“](#ä¸‹è½½cortex-mæ¶æ„microåº“)ç« èŠ‚è·å¾—çš„å‹ç¼©åŒ…è§£å‹åæ”¾åˆ°ç”Ÿæˆçš„æ¨ç†ä»£ç ç›®å½•å†…ï¼Œç›®å½•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

    ```text
    stm32f767                                       # MCUå·¥ç¨‹ç›®å½•
    â”œâ”€â”€ Core
    â”‚Â Â  â”œâ”€â”€ Inc
    â”‚Â Â  â””â”€â”€ Src
    â”‚       â”œâ”€â”€ main.c
    â”‚       â””â”€â”€ ...
    â”œâ”€â”€ Drivers
    â”œâ”€â”€ mnist                                        # ç”Ÿæˆä»£ç æ ¹ç›®å½•
    â”‚Â Â  â”œâ”€â”€ benchmark                                # å¯¹æ¨¡å‹æ¨ç†ä»£ç è¿›è¡Œé›†æˆè°ƒç”¨çš„benchmarkä¾‹ç¨‹
    â”‚   â”‚   â”œâ”€â”€ benchmark.c
    â”‚   â”‚   â”œâ”€â”€ data.c
    â”‚   â”‚   â”œâ”€â”€ data.h
    â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”‚â”€â”€ mindspore-lite-1.8.0-none-cortex-m7      # ä¸‹è½½çš„Cortex-M7æ¶æ„`Micro`åº“
    â”‚   â”œâ”€â”€ src                                      # æ¨¡å‹æ¨ç†ä»£ç ç›®å½•
    â”‚Â Â  â””â”€â”€ ...
    â”œâ”€â”€ Makefile
    â”œâ”€â”€ startup_stm32f767xx.s
    â””â”€â”€ STM32F767IGTx_FLASH.ld
    ```

- ä¿®æ”¹`MakeFile`ï¼Œå°†æ¨¡å‹æ¨ç†ä»£ç åŠä¾èµ–åº“åŠ å…¥å·¥ç¨‹

    æœ¬ä¾‹ä¸­è¦åŠ å…¥å·¥ç¨‹çš„æºä»£ç åŒ…æ‹¬`src`ä¸‹çš„æ¨¡å‹æ¨ç†ä»£ç å’Œ`benchmark`ç›®å½•ä¸‹çš„æ¨¡å‹æ¨ç†è°ƒç”¨ç¤ºä¾‹ä»£ç ï¼Œ
    ä¿®æ”¹`MakeFile`ä¸­çš„`C_SOURCES`å˜é‡å®šä¹‰ï¼ŒåŠ å…¥æºæ–‡ä»¶è·¯å¾„ï¼š

    ```bash
    C_SOURCES =  \
    mnist/src/context.c \
    mnist/src/model.c \
    mnist/src/net.c \
    mnist/src/tensor.c \
    mnist/src/weight.c \
    mnist/benchmark/benchmark.c \
    mnist/benchmark/calib_output.c \
    mnist/benchmark/load_input.c \
    mnist/benchmark/data.c \
    ...
    ```

    åŠ å…¥ä¾èµ–çš„å¤´æ–‡ä»¶è·¯å¾„ï¼šä¿®æ”¹`MakeFile`ä¸­çš„`C_INCLUDES`å˜é‡å®šä¹‰ï¼ŒåŠ å…¥ä»¥ä¸‹è·¯å¾„ï¼š

    ```text
    LITE_PACK = mindspore-lite-1.8.0-none-cortex-m7

    C_INCLUDES =  \
    -Imnist/$(LITE_PACK)/runtime \
    -Imnist/$(LITE_PACK)/runtime/include \
    -Imnist/$(LITE_PACK)/tools/codegen/include \
    -Imnist/$(LITE_PACK)/tools/codegen/third_party/include/CMSIS/Core \
    -Imnist/$(LITE_PACK)/tools/codegen/third_party/include/CMSIS/DSP \
    -Imnist/$(LITE_PACK)/tools/codegen/third_party/include/CMSIS/NN \
    -Imnist \
    ...
    ```

    åŠ å…¥ä¾èµ–çš„ç®—å­åº“ï¼ˆ`-lnnacl -lwrapper -lcmsis_nn`ï¼‰ï¼Œå£°æ˜ç®—å­åº“æ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œå¢åŠ é“¾æ¥æ—¶ç¼–è¯‘é€‰é¡¹ï¼ˆ`-specs=nosys.specs`ï¼‰ã€‚
    æœ¬ä¾‹ä¸­ä¿®æ”¹åçš„ç›¸å…³å˜é‡å®šä¹‰å¦‚ä¸‹ï¼š

    ```text
    LIBS = -lc -lm -lnosys -lnnacl -lwrapper -lcmsis_nn
    LIBDIR = -Lmnist/$(LITE_PACK)/tools/codegen/lib -Lmnist/$(LITE_PACK)/tools/codegen/third_party/lib
    LDFLAGS = $(MCU) -specs=nosys.specs -specs=nano.specs -T$(LDSCRIPT) $(LIBDIR) $(LIBS) -Wl,-Map=$(BUILD_DIR)/$(TARGET).map,--cref -Wl,--gc-sections
    ```

- ä¿®æ”¹main.cæ–‡ä»¶ï¼Œè°ƒç”¨benchmarkå‡½æ•°

    åœ¨mainå‡½æ•°ä¸­è°ƒç”¨`benchmark.c`ä¸­çš„`benchmark`å‡½æ•°ï¼Œbenchmarkæ–‡ä»¶å¤¹å†…çš„ç¨‹åºä¸ºå¯¹ç”Ÿæˆçš„`src`å†…çš„æ¨ç†ä»£ç è¿›è¡Œæ¨ç†è°ƒç”¨å¹¶æ¯”è¾ƒè¾“å‡ºçš„ç¤ºèŒƒæ ·ä¾‹ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥è‡ªç”±å¯¹å®ƒè¿›è¡Œä¿®æ”¹ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨`benchmark`å‡½æ•°ï¼Œå¹¶æ ¹æ®è¿”å›ç»“æœï¼Œèµ‹å€¼`run_dnn_flag`å˜é‡ã€‚

    ```c++
    run_dnn_flag = '0';
    if (benchmark() == 0) {
        printf("\nrun success.\n");
        run_dnn_flag = '1';
    } else {
        printf("\nrun failed.\n");
        run_dnn_flag = '2';
    }
    ```

    åœ¨`main.c`å¼€å¤´å¢åŠ å¤´æ–‡ä»¶å¼•ç”¨å’Œ`run_dnn_flag`å˜é‡çš„å®šä¹‰ã€‚

    ```c++
    #include "benchmark/benchmark.h"

    char run_dnn_flag __attribute__((section(".myram"))) ;//æµ‹è¯•ç”¨æ•°ç»„
    ```

    åœ¨æœ¬ä¾‹ä¸­ï¼Œä¸ºæ–¹ä¾¿ç›´æ¥ä½¿ç”¨çƒ§å½•å™¨å¯¹æ¨ç†ç»“æœè¿›è¡Œè¯»å–ï¼ŒæŠŠå˜é‡å®šä¹‰åœ¨äº†è‡ªå®šä¹‰çš„sectionæ®µï¼ˆ`myram`ï¼‰ä¸­ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸‹é¢æ–¹å¼è®¾ç½®è‡ªå®šä¹‰çš„sectionæ®µï¼Œæˆ–è€…å¿½ç•¥è¯¥å£°æ˜ï¼Œé‡‡ç”¨ä¸²å£æˆ–å…¶ä»–äº¤äº’æ–¹å¼å¾—åˆ°æ¨ç†ç»“æœã€‚

    è‡ªå®šä¹‰sectionæ®µçš„è®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š
    ä¿®æ”¹`STM32F767IGTx_FLASH.ld`ä¸­çš„`MEMORY`æ®µï¼Œå¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰å†…å­˜æ®µ`MYRAM`(åœ¨æœ¬ä¾‹ä¸­ï¼Œå°†`RAM`å†…å­˜èµ·å§‹åœ°å€åŠ 4ï¼Œä»¥è…¾å‡ºå†…å­˜ç»™`MYRAM`)ï¼›æ¥ç€åœ¨`SECTIONS`æ®µå†…å¢åŠ è‡ªå®šä¹‰çš„`myram`æ®µå£°æ˜ã€‚

    ```text
    MEMORY
    {
    MYRAM (xrw)     : ORIGIN = 0x20000000, LENGTH = 1
    RAM (xrw)      : ORIGIN = 0x20000004, LENGTH = 524284
    ...
    }
    ...
    SECTIONS
    {
      ...
      .myram (NOLOAD):
      {
        . = ALIGN(4);
        _smyram = .;        /* create a global symbol at data start */
        *(.sram)           /* .data sections */
        *(.sram*)          /* .data* sections */

        . = ALIGN(4);
        _emyram = .;        /* define a global symbol at data end */
      } >MYRAM AT> FLASH
    }
    ```

- ä¿®æ”¹`mnist/benchmark/data.c`æ–‡ä»¶ï¼Œå°†æ ‡æ†è¾“å…¥è¾“å‡ºæ•°æ®å­˜æ”¾åœ¨ç¨‹åºå†…ä»¥è¿›è¡Œå¯¹æ¯”

    åœ¨benchmarkä¾‹ç¨‹å†…ï¼Œä¼šè®¾ç½®æ¨¡å‹çš„è¾“å…¥æ•°æ®ï¼Œå¹¶å°†æ¨ç†ç»“æœå’Œè®¾å®šçš„æœŸæœ›ç»“æœè¿›è¡Œå¯¹æ¯”ï¼Œå¾—åˆ°è¯¯å·®åç§»å€¼ã€‚
    åœ¨æœ¬ä¾‹ä¸­ï¼Œé€šè¿‡ä¿®æ”¹`data.c`çš„`calib_input0_data`æ•°ç»„ï¼Œè®¾ç½®æ¨¡å‹çš„è¾“å…¥æ•°æ®ï¼Œé€šè¿‡ä¿®æ”¹`calib_output0_data`ï¼Œè®¾å®šæœŸæœ›ç»“æœã€‚

    ```c++
    float calib_input0_data[NET_INPUT0_SIZE] = {0.54881352186203,0.7151893377304077,0.6027633547782898,0.5448831915855408,0.42365479469299316,0.6458941102027893,0.4375872015953064,0.891772985458374,0.9636627435684204,0.3834415078163147,0.7917250394821167,0.5288949012756348,0.5680445432662964,0.9255966544151306,0.07103605568408966,0.08712930232286453,0.020218396559357643,0.832619845867157,0.7781567573547363,0.8700121641159058,0.978618323802948,0.7991585731506348,0.4614793658256531,0.7805292010307312,0.11827442795038223,0.6399210095405579,0.14335328340530396,0.9446688890457153,0.5218483209609985,0.4146619439125061,0.26455560326576233,0.7742336988449097,0.4561503231525421,0.568433940410614,0.018789799883961678,0.6176354885101318,0.6120957136154175,0.6169340014457703,0.9437480568885803,0.681820273399353,0.35950788855552673,0.43703195452690125,0.6976311802864075,0.0602254718542099,0.6667667031288147,0.670637845993042,0.21038256585597992,0.12892629206180573,0.31542834639549255,0.36371076107025146,0.5701967477798462,0.4386015236377716,0.9883738160133362,0.10204481333494186,0.20887675881385803,0.16130951046943665,0.6531082987785339,0.25329160690307617,0.4663107693195343,0.24442559480667114,0.15896958112716675,0.11037514358758926,0.6563295722007751,0.13818295300006866,0.1965823620557785,0.3687251806259155,0.8209932446479797,0.09710127860307693,0.8379449248313904,0.0960984081029892,0.9764594435691833,0.4686512053012848,0.9767611026763916,0.6048455238342285,0.7392635941505432,0.03918779268860817,0.28280696272850037,0.12019655853509903,0.296140193939209,0.11872772127389908,0.3179831802845001,0.414262980222702,0.06414749473333359,0.6924721002578735,0.5666014552116394,0.26538950204849243,0.5232480764389038,0.09394051134586334,0.5759465098381042,0.9292961955070496,0.3185689449310303,0.6674103736877441,0.13179786503314972,0.7163271903991699,0.28940609097480774,0.18319135904312134,0.5865129232406616,0.02010754682123661,0.8289400339126587,0.004695476032793522,0.6778165102005005,0.2700079679489136,0.7351940274238586,0.9621885418891907,0.2487531453371048,0.5761573314666748,0.5920419096946716,0.5722519159317017,0.22308163344860077,0.9527490139007568,0.4471253752708435,0.8464086651802063,0.6994792819023132,0.2974369525909424,0.8137978315353394,0.396505743265152,0.8811032176017761,0.5812729001045227,0.8817353844642639,0.6925315856933594,0.7252542972564697,0.5013243556022644,0.9560836553573608,0.6439902186393738,0.4238550364971161,0.6063932180404663,0.019193198531866074,0.30157482624053955,0.6601735353469849,0.2900775969028473,0.6180154085159302,0.42876869440078735,0.1354740709066391,0.29828232526779175,0.5699648857116699,0.5908727645874023,0.5743252635002136,0.6532008051872253,0.6521032452583313,0.43141844868659973,0.8965466022491455,0.36756187677383423,0.4358649253845215,0.8919233679771423,0.806194007396698,0.7038885951042175,0.10022688657045364,0.9194825887680054,0.7142413258552551,0.9988470077514648,0.14944830536842346,0.8681260347366333,0.16249293088912964,0.6155595779418945,0.1238199844956398,0.8480082154273987,0.8073189854621887,0.5691007375717163,0.40718328952789307,0.06916699558496475,0.6974287629127502,0.45354267954826355,0.7220556139945984,0.8663823008537292,0.9755215048789978,0.855803370475769,0.011714084073901176,0.359978049993515,0.729990541934967,0.17162968218326569,0.5210366249084473,0.054337989538908005,0.19999653100967407,0.01852179504930973,0.793697714805603,0.2239246815443039,0.3453516662120819,0.9280812740325928,0.704414427280426,0.031838931143283844,0.1646941602230072,0.6214783787727356,0.5772286057472229,0.23789282143115997,0.9342139959335327,0.6139659285545349,0.5356327891349792,0.5899099707603455,0.7301220297813416,0.31194499135017395,0.39822107553482056,0.20984375476837158,0.18619300425052643,0.9443724155426025,0.739550769329071,0.49045881628990173,0.22741462290287018,0.2543564736843109,0.058029159903526306,0.43441662192344666,0.3117958903312683,0.6963434815406799,0.37775182723999023,0.1796036809682846,0.024678727611899376,0.06724963337182999,0.6793927550315857,0.4536968469619751,0.5365791916847229,0.8966712951660156,0.990338921546936,0.21689698100090027,0.6630781888961792,0.2633223831653595,0.02065099962055683,0.7583786249160767,0.32001715898513794,0.38346388936042786,0.5883170962333679,0.8310484290122986,0.6289818286895752,0.872650682926178,0.27354204654693604,0.7980468273162842,0.18563593924045563,0.9527916312217712,0.6874882578849792,0.21550767123699188,0.9473705887794495,0.7308558225631714,0.2539416551589966,0.21331197023391724,0.518200695514679,0.02566271834075451,0.20747007429599762,0.4246854782104492,0.3741699755191803,0.46357542276382446,0.27762871980667114,0.5867843627929688,0.8638556003570557,0.11753185838460922,0.517379105091095,0.13206811249256134,0.7168596982955933,0.39605969190597534,0.5654212832450867,0.1832798421382904,0.14484776556491852,0.4880562722682953,0.35561272501945496,0.9404319524765015,0.7653252482414246,0.748663604259491,0.9037197232246399,0.08342243731021881,0.5521924495697021,0.5844760537147522,0.961936354637146,0.29214751720428467,0.24082878232002258,0.10029394179582596,0.016429629176855087,0.9295293092727661,0.669916570186615,0.7851529121398926,0.28173011541366577,0.5864101648330688,0.06395526975393295,0.48562759160995483,0.9774951338768005,0.8765052556991577,0.3381589651107788,0.961570143699646,0.23170162737369537,0.9493188261985779,0.9413776993751526,0.799202561378479,0.6304479241371155,0.8742879629135132,0.2930202782154083,0.8489435315132141,0.6178767085075378,0.013236857950687408,0.34723350405693054,0.14814086258411407,0.9818294048309326,0.4783703088760376,0.49739137291908264,0.6394725441932678,0.36858460307121277,0.13690027594566345,0.8221177458763123,0.1898479163646698,0.5113189816474915,0.2243170291185379,0.09784448146820068,0.8621914982795715,0.9729194641113281,0.9608346819877625,0.9065554738044739,0.774047315120697,0.3331451416015625,0.08110138773918152,0.40724116563796997,0.2322341352701187,0.13248763978481293,0.053427182137966156,0.7255943417549133,0.011427458375692368,0.7705807685852051,0.14694663882255554,0.07952208071947098,0.08960303664207458,0.6720477938652039,0.24536721408367157,0.4205394685268402,0.557368814945221,0.8605511784553528,0.7270442843437195,0.2703278958797455,0.131482794880867,0.05537432059645653,0.3015986382961273,0.2621181607246399,0.45614057779312134,0.6832813620567322,0.6956254243850708,0.28351885080337524,0.3799269497394562,0.18115095794200897,0.7885454893112183,0.05684807524085045,0.6969972252845764,0.7786954045295715,0.7774075865745544,0.25942257046699524,0.3738131523132324,0.5875996351242065,0.27282190322875977,0.3708527982234955,0.19705428183078766,0.4598558843135834,0.044612299650907516,0.7997958660125732,0.07695644348859787,0.5188351273536682,0.3068101108074188,0.5775429606437683,0.9594333171844482,0.6455702185630798,0.03536243736743927,0.4304024279117584,0.5100168585777283,0.5361775159835815,0.6813924908638,0.2775960862636566,0.12886056303977966,0.3926756680011749,0.9564056992530823,0.1871308982372284,0.9039839506149292,0.5438059568405151,0.4569114148616791,0.8820413947105408,0.45860394835472107,0.7241676449775696,0.3990253210067749,0.9040443897247314,0.6900250315666199,0.6996220350265503,0.32772040367126465,0.7567786574363708,0.6360610723495483,0.2400202751159668,0.16053882241249084,0.796391487121582,0.9591665863990784,0.4581388235092163,0.5909841656684875,0.8577226400375366,0.45722344517707825,0.9518744945526123,0.5757511854171753,0.8207671046257019,0.9088436961174011,0.8155238032341003,0.15941447019577026,0.6288984417915344,0.39843425154685974,0.06271295249462128,0.4240322411060333,0.25868406891822815,0.849038302898407,0.03330462798476219,0.9589827060699463,0.35536885261535645,0.3567068874835968,0.01632850244641304,0.18523232638835907,0.40125951170921326,0.9292914271354675,0.0996149331331253,0.9453015327453613,0.869488537311554,0.4541623890399933,0.326700896024704,0.23274412751197815,0.6144647002220154,0.03307459130883217,0.015606064349412918,0.428795725107193,0.06807407736778259,0.2519409954547882,0.2211609184741974,0.253191202878952,0.13105523586273193,0.012036222964525223,0.11548429727554321,0.6184802651405334,0.9742562174797058,0.9903450012207031,0.40905410051345825,0.1629544198513031,0.6387617588043213,0.4903053343296051,0.9894098043441772,0.06530420482158661,0.7832344174385071,0.28839850425720215,0.24141861498355865,0.6625045537948608,0.24606318771839142,0.6658591032028198,0.5173085331916809,0.4240889847278595,0.5546877980232239,0.2870515286922455,0.7065746784210205,0.414856880903244,0.3605455458164215,0.8286569118499756,0.9249669313430786,0.04600730910897255,0.2326269894838333,0.34851935505867004,0.8149664998054504,0.9854914546012878,0.9689717292785645,0.904948353767395,0.2965562641620636,0.9920112490653992,0.24942004680633545,0.10590615123510361,0.9509525895118713,0.2334202527999878,0.6897682547569275,0.05835635960102081,0.7307090759277344,0.8817201852798462,0.27243688702583313,0.3790569007396698,0.3742961883544922,0.7487882375717163,0.2378072440624237,0.17185309529304504,0.4492916464805603,0.30446839332580566,0.8391891121864319,0.23774182796478271,0.5023894309997559,0.9425836205482483,0.6339976787567139,0.8672894239425659,0.940209686756134,0.7507648468017578,0.6995750665664673,0.9679655432701111,0.9944007992744446,0.4518216848373413,0.07086978107690811,0.29279401898384094,0.15235470235347748,0.41748636960983276,0.13128933310508728,0.6041178107261658,0.38280805945396423,0.8953858613967896,0.96779465675354,0.5468848943710327,0.2748235762119293,0.5922304391860962,0.8967611789703369,0.40673333406448364,0.5520782470703125,0.2716527581214905,0.4554441571235657,0.4017135500907898,0.24841345846652985,0.5058664083480835,0.31038081645965576,0.37303486466407776,0.5249704718589783,0.7505950331687927,0.3335074782371521,0.9241587519645691,0.8623185753822327,0.048690296709537506,0.2536425292491913,0.4461355209350586,0.10462789237499237,0.34847599267959595,0.7400975227355957,0.6805144548416138,0.6223844289779663,0.7105283737182617,0.20492368936538696,0.3416981101036072,0.676242470741272,0.879234790802002,0.5436780452728271,0.2826996445655823,0.030235258862376213,0.7103368043899536,0.007884103804826736,0.37267908453941345,0.5305371880531311,0.922111451625824,0.08949454873800278,0.40594232082366943,0.024313200265169144,0.3426109850406647,0.6222310662269592,0.2790679335594177,0.2097499519586563,0.11570323258638382,0.5771402716636658,0.6952700018882751,0.6719571352005005,0.9488610029220581,0.002703213831409812,0.6471966505050659,0.60039222240448,0.5887396335601807,0.9627703428268433,0.016871673986315727,0.6964824199676514,0.8136786222457886,0.5098071694374084,0.33396488428115845,0.7908401489257812,0.09724292904138565,0.44203564524650574,0.5199523568153381,0.6939564347267151,0.09088572859764099,0.2277594953775406,0.4103015661239624,0.6232946515083313,0.8869608044624329,0.618826150894165,0.13346147537231445,0.9805801510810852,0.8717857599258423,0.5027207732200623,0.9223479628562927,0.5413808226585388,0.9233060479164124,0.8298973441123962,0.968286395072937,0.919782817363739,0.03603381663560867,0.1747720092535019,0.3891346752643585,0.9521427154541016,0.300028920173645,0.16046763956546783,0.8863046765327454,0.4463944137096405,0.9078755974769592,0.16023047268390656,0.6611174941062927,0.4402637481689453,0.07648676633834839,0.6964631676673889,0.2473987489938736,0.03961552307009697,0.05994429811835289,0.06107853725552559,0.9077329635620117,0.7398838996887207,0.8980623483657837,0.6725823283195496,0.5289399027824402,0.30444636940956116,0.997962236404419,0.36218905448913574,0.47064894437789917,0.37824517488479614,0.979526937007904,0.1746583878993988,0.32798799872398376,0.6803486943244934,0.06320761889219284,0.60724937915802,0.47764649987220764,0.2839999794960022,0.2384132742881775,0.5145127177238464,0.36792758107185364,0.4565199017524719,0.3374773859977722,0.9704936742782593,0.13343943655490875,0.09680395573377609,0.3433917164802551,0.5910269021987915,0.6591764688491821,0.3972567617893219,0.9992780089378357,0.35189300775527954,0.7214066386222839,0.6375827193260193,0.8130538463592529,0.9762256741523743,0.8897936344146729,0.7645619511604309,0.6982485055923462,0.335498183965683,0.14768557250499725,0.06263600289821625,0.2419017106294632,0.432281494140625,0.521996259689331,0.7730835676193237,0.9587409496307373,0.1173204779624939,0.10700414329767227,0.5896947383880615,0.7453980445861816,0.848150372505188,0.9358320832252502,0.9834262132644653,0.39980170130729675,0.3803351819515228,0.14780867099761963,0.6849344372749329,0.6567619442939758,0.8620625734329224,0.09725799411535263,0.49777689576148987,0.5810819268226624,0.2415570467710495,0.16902540624141693,0.8595808148384094,0.05853492394089699,0.47062090039253235,0.11583399772644043,0.45705875754356384,0.9799623489379883,0.4237063527107239,0.857124924659729,0.11731556057929993,0.2712520658969879,0.40379273891448975,0.39981213212013245,0.6713835000991821,0.3447181284427643,0.713766872882843,0.6391869187355042,0.399161159992218,0.43176013231277466,0.614527702331543,0.0700421929359436,0.8224067091941833,0.65342116355896,0.7263424396514893,0.5369229912757874,0.11047711223363876,0.4050356149673462,0.40537357330322266,0.3210429847240448,0.029950324445962906,0.73725426197052,0.10978446155786514,0.6063081622123718,0.7032175064086914,0.6347863078117371,0.95914226770401,0.10329815745353699,0.8671671748161316,0.02919023483991623,0.534916877746582,0.4042436182498932,0.5241838693618774,0.36509987711906433,0.19056691229343414,0.01912289671599865,0.5181497931480408,0.8427768349647522,0.3732159435749054,0.2228638231754303,0.080532006919384,0.0853109210729599,0.22139644622802734,0.10001406073570251,0.26503971219062805,0.06614946573972702,0.06560486555099487,0.8562761545181274,0.1621202677488327,0.5596824288368225,0.7734555602073669,0.4564095735549927,0.15336887538433075,0.19959613680839539,0.43298420310020447,0.52823406457901,0.3494403064250946,0.7814795970916748,0.7510216236114502,0.9272118210792542,0.028952548280358315,0.8956912755966187,0.39256879687309265,0.8783724904060364,0.690784752368927,0.987348735332489,0.7592824697494507,0.3645446300506592,0.5010631680488586,0.37638914585113525,0.364911824464798,0.2609044909477234,0.49597030878067017,0.6817399263381958,0.27734026312828064,0.5243797898292542,0.117380291223526,0.1598452925682068,0.04680635407567024,0.9707314372062683,0.0038603513967245817,0.17857997119426727,0.6128667593002319,0.08136960119009018,0.8818964958190918,0.7196201682090759,0.9663899540901184,0.5076355338096619,0.3004036843776703,0.549500584602356,0.9308187365531921,0.5207614302635193,0.2672070264816284,0.8773987889289856,0.3719187378883362,0.0013833499979227781,0.2476850152015686,0.31823351979255676,0.8587774634361267,0.4585031569004059,0.4445872902870178,0.33610227704048157,0.880678117275238,0.9450267553329468,0.9918903112411499,0.3767412602901459,0.9661474227905273,0.7918795943260193,0.675689160823822,0.24488948285579681,0.21645726263523102,0.1660478264093399,0.9227566123008728,0.2940766513347626,0.4530942440032959,0.49395784735679626,0.7781715989112854,0.8442349433898926,0.1390727013349533,0.4269043505191803,0.842854917049408,0.8180332779884338};
    float calib_output0_data[NET_OUTPUT0_SIZE] = {3.5647096e-05,6.824297e-08,0.009327697,3.2340475e-05,1.1117579e-05,1.5117058e-06,4.6314454e-07,5.161628e-11,0.9905911,3.8835238e-10};
    ```

#### ç¼–è¯‘å·¥ç¨‹åŠçƒ§å½•

- ç¼–è¯‘

    åœ¨MCUå·¥ç¨‹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ`make`å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘æˆåŠŸåæ˜¾ç¤ºå¦‚ä¸‹ï¼Œtest_stm767ä¸ºæœ¬ä¾‹çš„MCUå·¥ç¨‹åï¼š

    ```text
    arm-none-eabi-size build/test_stm767.elf
    text      data    bss    dec       hex      filename
    120316    3620    87885  211821    33b6d    build/test_stm767.elf
    arm-none-eabi-objcopy -O ihex build/test_stm767.elf build/test_stm767.hex
    arm-none-eabi-objcopy -O binary -S build/test_stm767.elf build/test_stm767.bin
    ```

- çƒ§å½•è¿è¡Œ

    æˆ‘ä»¬å¯ä»¥é€šè¿‡`STMSTM32CubePrg`çƒ§å½•å·¥å…·è¿›è¡Œä»£ç çƒ§å½•å¹¶è¿è¡Œã€‚åœ¨PCæœºä¸Šï¼Œé€šè¿‡`STLink`è¿æ¥ä¸€å—å¯çƒ§å½•çš„å¼€å‘æ¿ï¼Œç„¶ååœ¨å½“å‰MCUå·¥ç¨‹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰§è¡Œçƒ§å½•å¹¶è¿è¡Œç¨‹åºï¼š

    ```bash
    bash ${STMSTM32CubePrg_PATH}/bin/STM32_Programmer.sh -c port=SWD -w build/test_stm767.bin 0x08000000 -s 0x08000000
    ```

    ${STMSTM32CubePrg_PATHä¸º}ä¸º`STMSTM32CubePrg`å®‰è£…è·¯å¾„ã€‚å…³äºå‘½ä»¤ä¸­çš„å„å‚æ•°å«ä¹‰ï¼Œè¯·å‚è€ƒ`STMSTM32CubePrg`çš„ä½¿ç”¨æ‰‹å†Œã€‚

#### æ¨ç†ç»“æœéªŒè¯

æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æŠŠbenchmarkè¿è¡Œç»“æœæ ‡å¿—ä¿å­˜åœ¨äº†èµ·å§‹åœ°å€ä¸º`0x20000000`ä¸”å¤§å°ä¸º1å­—èŠ‚çš„å†…å­˜æ®µå†…ï¼Œæ•…å¯ä»¥ç›´æ¥é€šè¿‡çƒ§å½•å™¨è·å–è¯¥å¤„åœ°å€çš„æ•°æ®ï¼Œä»¥å¾—åˆ°ç¨‹åºè¿”å›ç»“æœã€‚
åœ¨PCæœºä¸Šï¼Œé€šè¿‡`STLink`è¿æ¥ä¸€å—å·²çƒ§å½•å¥½ç¨‹åºçš„å¼€å‘æ¿ï¼Œé€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¯»å–å†…å­˜æ•°æ®ï¼š

```bash
bash ${STMSTM32CubePrg_PATHä¸º}/bin/STM32_Programmer.sh -c port=SWD model=HOTPLUG --upload 0x20000000 0x1 ret.bin
```

${STMSTM32CubePrg_PATHä¸º}ä¸º`STMSTM32CubePrg`å®‰è£…è·¯å¾„ã€‚å…³äºå‘½ä»¤ä¸­çš„å„å‚æ•°å«ä¹‰ï¼Œè¯·å‚è€ƒ`STMSTM32CubePrg`çš„ä½¿ç”¨æ‰‹å†Œã€‚

è¯»å–çš„æ•°æ®è¢«ä¿å­˜åœ¨`ret.bin`æ–‡ä»¶å†…ï¼Œè¿è¡Œ`cat ret.bin`ï¼Œå¦‚æœæ¿ç«¯æ¨ç†æˆåŠŸï¼Œ`ret.bin`å†…ä¿å­˜ç€å­—ç¬¦`1`ï¼Œä¼šæ˜¾ç¤ºå¦‚ä¸‹ï¼š

```text
1
```

## åœ¨è½»é¸¿è’™è®¾å¤‡ä¸Šæ‰§è¡Œæ¨ç†

### è½»é¸¿è’™ç¼–è¯‘ç¯å¢ƒå‡†å¤‡

ç”¨æˆ·å¯ä»¥é€šè¿‡[OpenHarmonyå®˜ç½‘](https://www.openharmony.cn)æ¥å­¦ä¹ è½»é¸¿è’™ç¯å¢ƒä¸‹çš„ç¼–è¯‘åŠçƒ§å½•ã€‚
æœ¬æ•™ç¨‹ä»¥Hi3516å¼€å‘æ¿ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•åœ¨è½»é¸¿è’™ç¯å¢ƒä¸Šä½¿ç”¨Microéƒ¨ç½²æ¨ç†æ¨¡å‹ã€‚

### ç¼–è¯‘æ¨¡å‹

ä½¿ç”¨converter_liteç¼–è¯‘[lenetæ¨¡å‹](https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/mnist.tar.gz)ï¼Œç”Ÿæˆå¯¹åº”è½»é¸¿è’™å¹³å°çš„æ¨ç†ä»£ç ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```shell
./converter_lite --fmk=TFLITE --modelFile=mnist.tflite --outputFile=${SOURCE_CODE_DIR} --configFile=${COFIG_FILE}
```

å…¶ä¸­configé…ç½®æ–‡ä»¶è®¾ç½®target = ARM32ã€‚

### ç¼–å†™æ„å»ºè„šæœ¬

è½»é¸¿è’™åº”ç”¨ç¨‹åºå¼€å‘è¯·å…ˆå‚è€ƒ[è¿è¡ŒHello OHOS](https://device.harmonyos.com/cn/docs/start/introduce/quickstart-lite-steps-board3516-running-0000001151888681)ã€‚å°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„mnistç›®å½•æ‹·è´åˆ°ä»»æ„é¸¿è’™æºç è·¯å¾„ä¸‹ï¼Œå‡è®¾ä¸ºapplications/sample/ï¼Œç„¶åæ–°å»ºBUILD.gnæ–‡ä»¶ï¼š

```text
<harmony-source-path>/applications/sample/mnist
â”œâ”€â”€ benchmark
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ BUILD.gn
â””â”€â”€ src  
```

ä¸‹è½½é€‚ç”¨äºOpenHarmonyçš„[é¢„ç¼–è¯‘æ¨ç†runtimeåŒ…](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/downloads.html)ï¼Œç„¶åå°†å…¶è§£å‹è‡³ä»»æ„é¸¿è’™æºç è·¯å¾„ä¸‹ã€‚ç¼–å†™BUILD.gnæ–‡ä»¶ï¼š

```text
import("//build/lite/config/component/lite_component.gni")
import("//build/lite/ndk/ndk.gni")

lite_component("mnist_benchmark") {
    target_type = "executable"
    sources = [
        "benchmark/benchmark.cc",
        "benchmark/calib_output.cc",
        "benchmark/load_input.c",
        "src/net.c",
        "src/weight.c",
        "src/session.cc",
        "src/tensor.cc",
    ]
    features = []
    include_dirs = [
        "<YOUR MINDSPORE LITE RUNTIME PATH>/runtime",
        "<YOUR MINDSPORE LITE RUNTIME PATH>/tools/codegen/include",
        "//applications/sample/mnist/benchmark",
        "//applications/sample/mnist/src",
    ]
    ldflags = [
        "-fno-strict-aliasing",
        "-Wall",
        "-pedantic",
        "-std=gnu99",
    ]
    libs = [
        "<YOUR MINDSPORE LITE RUNTIME PATH>/runtime/lib/libmindspore-lite.a",
        "<YOUR MINDSPORE LITE RUNTIME PATH>/tools/codegen/lib/libwrapper.a",
    ]
    defines = [
        "NOT_USE_STL",
        "ENABLE_NEON",
        "ENABLE_ARM",
        "ENABLE_ARM32"
    ]
    cflags = [
        "-fno-strict-aliasing",
        "-Wall",
        "-pedantic",
        "-std=gnu99",
    ]
    cflags_cc = [
        "-fno-strict-aliasing",
        "-Wall",
        "-pedantic",
        "-std=c++17",
    ]
}
```

`<YOUR MINDSPORE LITE RUNTIME PATH>`æ˜¯è§£å‹å‡ºæ¥çš„æ¨ç†runtimeåŒ…è·¯å¾„ï¼Œæ¯”å¦‚//applications/sample/mnist/mindspore-lite-1.3.0-ohos-aarch32ã€‚
ä¿®æ”¹æ–‡ä»¶build/lite/components/applications.jsonï¼Œæ·»åŠ ç»„ä»¶mnist_benchmarkçš„é…ç½®ï¼š

```text
{
    "component": "mnist_benchmark",
    "description": "Communication related samples.",
    "optional": "true",
    "dirs": [
    "applications/sample/mnist"
    ],
    "targets": [
    "//applications/sample/mnist:mnist_benchmark"
    ],
    "rom": "",
    "ram": "",
    "output": [],
    "adapted_kernel": [ "liteos_a" ],
    "features": [],
    "deps": {
    "components": [],
    "third_party": []
    }
},
```

ä¿®æ”¹æ–‡ä»¶vendor/hisilicon/hispark_taurus/config.jsonï¼Œæ–°å¢mnist_benchmarkç»„ä»¶çš„æ¡ç›®:

```text
{ "component": "mnist_benchmark", "features":[] }
```

### ç¼–è¯‘benchmark

```text
cd <openharmony-source-path>
hb set(è®¾ç½®ç¼–è¯‘è·¯å¾„)
.ï¼ˆé€‰æ‹©å½“å‰è·¯å¾„ï¼‰
é€‰æ‹©ipcamera_hispark_taurus@hisiliconå¹¶å›è½¦
hb build mnist_benchmarkï¼ˆæ‰§è¡Œç¼–è¯‘ï¼‰
```

ç”Ÿæˆç»“æœæ–‡ä»¶out/hispark_taurus/ipcamera_hispark_taurus/bin/mnist_benchmarkã€‚

### æ‰§è¡Œbenchmark

å°†mnist_benchmarkã€æƒé‡æ–‡ä»¶ï¼ˆmnist/src/net.binï¼‰ä»¥åŠ[è¾“å…¥æ–‡ä»¶](https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/mnist.tar.gz)è§£å‹åæ‹·è´åˆ°å¼€å‘æ¿ä¸Šï¼Œç„¶åæ‰§è¡Œï¼š

```text
OHOS # ./mnist_benchmark mnist_input.bin net.bin 1
OHOS # =======run benchmark======
input 0: mnist_input.bin

loop count: 1
total time: 10.11800ms, per time: 10.11800ms

outputs:
name: int8toft32_Softmax-7_post0/output-0, DataType: 43, Elements: 10, Shape: [1 10 ], Data:
0.000000, 0.000000, 0.003906, 0.000000, 0.000000, 0.992188, 0.000000, 0.000000, 0.000000, 0.000000,
========run success=======
```

## è‡ªå®šä¹‰ç®—å­

ä½¿ç”¨å‰è¯·å…ˆå‚è€ƒ[è‡ªå®šä¹‰ç®—å­](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/register.html)äº†è§£åŸºæœ¬æ¦‚å¿µã€‚Microç›®å‰ä»…æ”¯æŒcustomç±»å‹çš„è‡ªå®šä¹‰ç®—å­æ³¨å†Œå’Œå®ç°ï¼Œæš‚ä¸æ”¯æŒå†…å»ºç®—å­ï¼ˆæ¯”å¦‚conv2dã€fcç­‰ï¼‰çš„æ³¨å†Œå’Œè‡ªå®šä¹‰å®ç°ã€‚ä¸‹é¢ä»¥æµ·æ€Hi3516Då¼€å‘æ¿ä¸ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•åœ¨Microä¸­ä½¿ç”¨è‡ªå®šä¹‰ç®—å­ã€‚

ä½¿ç”¨è½¬æ¢å·¥å…·ç”ŸæˆNNIEçš„è‡ªå®šä¹‰ç®—å­å…·ä½“æ­¥éª¤è¯·å‚è€ƒ[é›†æˆNNIEä½¿ç”¨è¯´æ˜](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/nnie.html)ã€‚

æ¨¡å‹ç”Ÿæˆä»£ç æ–¹å¼ä¸éè‡ªå®šä¹‰ç®—å­æ¨¡å‹ä¿æŒä¸€è‡´ï¼š

```shell

./converter_lite --fmk=TFLITE --modelFile=mnist.tflite --outputFile=${SOURCE_CODE_DIR} --configFile=${COFIG_FILE}

```

å…¶ä¸­configé…ç½®æ–‡ä»¶è®¾ç½®target = ARM32ã€‚

### ç”¨æˆ·å®ç°è‡ªå®šä¹‰ç®—å­

ä¸Šä¸€æ­¥ä¼šåœ¨ç”¨æˆ·æŒ‡å®šè·¯å¾„ä¸‹ç”Ÿæˆæºç ç›®å½•ï¼Œå…¶æœ‰ä¸€ä¸ªåä¸º`src/registered_kernel.h`çš„å¤´æ–‡ä»¶æŒ‡å®šäº†customç®—å­çš„å‡½æ•°å£°æ˜ï¼š

``` C++

int CustomKernel(TensorC *inputs, int input_num, TensorC *outputs, int output_num, CustomParameter *param);

```

ç”¨æˆ·éœ€è¦æä¾›è¯¥å‡½æ•°çš„å®ç°ï¼Œå¹¶å°†ç›¸å…³æºç æˆ–è€…åº“é›†æˆåˆ°ç”Ÿæˆä»£ç çš„cmakeå·¥ç¨‹ä¸­ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æä¾›äº†æ”¯æŒæµ·æ€NNIEçš„custom kernelç¤ºä¾‹åŠ¨æ€åº“libmicro_nnie.soï¼Œè¯¥æ–‡ä»¶åŒ…å«åœ¨[å®˜ç½‘ä¸‹è½½é¡µ](https://www.mindspore.cn/lite/docs/zh-CN/r2.0.0-alpha/use/downloads.html)â€œNNIE æ¨ç†runtimeåº“ã€benchmarkå·¥å…·â€ç»„ä»¶ä¸­ã€‚ç”¨æˆ·éœ€è¦ä¿®æ”¹ç”Ÿæˆä»£ç çš„CMakeLists.txtï¼Œæ·»åŠ é“¾æ¥çš„åº“åç§°å’Œè·¯å¾„ã€‚ä¾‹å¦‚ï¼š

``` shell

link_directories(<YOUR_PATH>/mindspore-lite-1.8.1-linux-aarch32/providers/Hi3516D)

link_directories(<HI3516D_SDK_PATH>)

target_link_libraries(benchmark net micro_nnie nnie mpi VoiceEngine upvqe dnvqe securec -lm -pthread)

```

åœ¨ç”Ÿæˆçš„`benchmark/benchmark.c`æ–‡ä»¶ä¸­ï¼Œåœ¨mainå‡½æ•°çš„è°ƒç”¨å‰åæ·»åŠ [NNIEè®¾å¤‡ç›¸å…³åˆå§‹åŒ–ä»£ç ](https://gitee.com/mindspore/mindspore/blob/r2.0.0-alpha/mindspore/lite/test/config_level0/micro/svp_sys_init.c)ï¼Œæœ€åè¿›è¡Œæºç ç¼–è¯‘ï¼š

``` shell

mkdir buid && cd build

cmake -DCMAKE_TOOLCHAIN_FILE=<MS_SRC_PATH>/mindspore/lite/cmake/himix200.toolchain.cmake -DPLATFORM_ARM32=ON -DPKG_PATH=<RUNTIME_PKG_PATH> ..

make

```

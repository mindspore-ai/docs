# Customized Dataset

<a href="https://gitee.com/mindspore/docs/blob/r1.9/tutorials/source_en/advanced/dataset/custom.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r1.9/resource/_static/logo_source_en.png"></a>

[mindspore.dataset](https://www.mindspore.cn/docs/en/r1.9/api_python/mindspore.dataset.html) provides APIs for loading some common datasets and datasets in standard formats. For datasets that cannot be directly loaded by MindSpore, you can customize dataset classes or dataset generation functions to generate datasets, and then load the customized datasets through the [mindspore.dataset.GeneratorDataset](https://www.mindspore.cn/docs/en/r1.9/api_python/dataset/mindspore.dataset.GeneratorDataset.html#mindspore.dataset.GeneratorDataset) API.

You can load and iterate datasets generated by customizing dataset classes and dataset generation functions. The random access function and the function for obtaining the dataset size are defined in the customized dataset class. Therefore, when you need to randomly access a piece of data in the dataset or obtain the dataset size, you can use the dataset generated by the customized dataset class to quickly complete these operations. The dataset generated by customized dataset generation function needs to traverse the data one by one to complete these operations.

Generally, when the data volume is small, you can use either of the two methods to generate a customized dataset. When the data volume is large, you are advised to use the customized dataset class to generate a dataset.

The following describes how to use the preceding two methods.

## Customized Dataset Classes

Customize the following class functions in the customized dataset class:

- `__init__`: It defines operations such as data initialization and is called when a dataset object is instantiated.
- `__getitem__`: After this function is defined, it supports random access. Data in the dataset can be obtained and returned based on the specified index value `index`. The return value type is Tuple consisting of NumPy arrays.
- `__len__`: returns the number of samples in the dataset.

After customizing a dataset class, you can load and access dataset samples through the `GeneratorDataset` API. The following uses two pieces of sample code to describe how to generate single-label and multi-label datasets by customizing dataset classes.

### Generating a Single-Label Datasets

Five groups of data are generated based on the customized dataset class `MyDataset`. Each group of data consists of two random numbers and has only one label. The sample code is as follows:

```python
import numpy as np
import mindspore.dataset as ds

np.random.seed(1)

class MyDataset:
    """Customize a dataset class."""

    def __init__(self):
        """Customize initialization operations."""
        self.data = np.random.sample((5, 2))  # Customize data.
        self.label = np.random.sample((5, 1))  # Customize a label.

    def __getitem__(self, index):
        """Customize a random access function."""
        return self.data[index], self.label[index]

    def __len__(self):
        """Customize a function for obtaining the sample data volume."""
        return len(self.data)

# Instantiate the dataset class.
dataset_generator = MyDataset()
dataset = ds.GeneratorDataset(dataset_generator, ["data", "label"], shuffle=False)

# Iteratively access the dataset.
for data in dataset.create_dict_iterator():
    data1 = data['data'].asnumpy()
    label1 = data['label'].asnumpy()
    print(f'data:[{data1[0]:7.5f}, {data1[1]:7.5f}], label:[{label1[0]:7.5f}]')

# Print the number of data records.
print("data size:", dataset.get_dataset_size())
```

```text
    data:[0.41702, 0.72032], label:[0.41919]
    data:[0.00011, 0.30233], label:[0.68522]
    data:[0.14676, 0.09234], label:[0.20445]
    data:[0.18626, 0.34556], label:[0.87812]
    data:[0.39677, 0.53882], label:[0.02739]
    data size: 5
```

According to the preceding information, there are five groups of datasets generated through the customized dataset class, and each group of data has a label.

### Generating Multi-Label Datasets

Five groups of data are generated based on the customized dataset class `MyDataset`. Each group of data consists of two random numbers and has two labels `label1` and `lable2`. The sample code is as follows:

```python
import numpy as np
import mindspore.dataset as ds

np.random.seed(1)

class MyDataset:
    """Customize a dataset class."""
    def __init__(self):
        """Customize initialization operations."""
        self.data = np.random.sample((5, 2))  # Customize data.
        self.label1 = np.random.sample((5, 1))  # Customize label 1.
        self.label2 = np.random.sample((5, 1))  # Customize label 2.

    def __getitem__(self, index):
        """Customize a random access function."""
        return self.data[index], self.label1[index], self.label2[index]

    def __len__(self):
        """Customize a function for obtaining the sample data volume."""
        return len(self.data)

# Instantiate the dataset class.
dataset_generator = MyDataset()
# Load the dataset.
dataset = ds.GeneratorDataset(dataset_generator, ["data", "label1", "label2"], shuffle=False)

# Iteratively access the dataset.
for data in dataset.create_dict_iterator():
    print("data:[{:7.5f},".format(data['data'].asnumpy()[0]),
          "{:7.5f}]  ".format(data['data'].asnumpy()[1]),
          "label1:[{:7.5f}]".format(data['label1'].asnumpy()[0]),
          "label2:[{:7.5f}]".format(data['label2'].asnumpy()[0]))

# Print the number of data records.
print("data size:", dataset.get_dataset_size())
```

```text
    data:[0.41702, 0.72032]   label1:[0.41919] label2:[0.67047]
    data:[0.00011, 0.30233]   label1:[0.68522] label2:[0.41730]
    data:[0.14676, 0.09234]   label1:[0.20445] label2:[0.55869]
    data:[0.18626, 0.34556]   label1:[0.87812] label2:[0.14039]
    data:[0.39677, 0.53882]   label1:[0.02739] label2:[0.19810]
    data size: 5
```

According to the preceding information, there are five groups of datasets generated through the customized dataset class, and each group of data has two labels.

## Customized Dataset Generation Functions

You can also use customized dataset generation functions to generate datasets, and then use the `GeneratorDataset` API to load and access the dataset sample.

The following uses two pieces of sample code to describe how to use customized dataset generation functions to generate single-label and multi-label datasets.

### Generating a Single-Label Datasets

Five groups of data are generated using the customized dataset generation function `get_singlelabel_data`. Each group of data consists of a random number and has only one label. The sample code is as follows:

```python
import numpy as np
from mindspore import dataset as ds

def get_singlelabel_data(num):
    """Define a function for generating single-label datasets."""
    for _ in range(num):
        data = np.random.uniform(-10.0, 10.0)  # Customize data.
        label = np.random.uniform(-1.0, 1.0)  # Customize a label.
        yield np.array([data]).astype(np.float32), np.array([label]).astype(np.float32)

# Define a dataset.
dataset = ds.GeneratorDataset(list(get_singlelabel_data(5)), column_names=['data', 'label'])

# Print the dataset.
for data in dataset.create_dict_iterator():
    print("data:[{:9.5f}]  ".format(data['data'].asnumpy()[0]),
          "label:[{:9.5f}]  ".format(data['label'].asnumpy()[0]))

# Print the number of data records.
print("data size:", dataset.get_dataset_size())
```

```text
    data:[ -3.73152]   label:[  0.38465]  
    data:[ -6.60339]   label:[  0.75629]  
    data:[  6.01489]   label:[  0.93652]  
    data:[ -8.29912]   label:[ -0.92189]  
    data:[  7.52778]   label:[  0.78921]  
    data size: 5
```

According to the preceding information, there are five groups of datasets generated through the customized dataset generation function `get_singlelabel_data`, and each group of data has only one label.

### Generating Multi-Label Datasets

A multi-label dataset is generated using a customized dataset generation function `get_multilabel_data`. Each group of data consists of a random number and has two labels.

The sample code is as follows:

```python
import numpy as np
from mindspore import dataset as ds

def get_multilabel_data(num, w=2.0, b=3.0):
    """Define a function for generating multi-label datasets."""
    for _ in range(num):
        data = np.random.uniform(-10.0, 10.0)  # Customize data.
        label1 = np.random.uniform(-1.0, 1.0)  # Customize label 1.
        label2 = np.random.uniform(1.0, 2.0)  # Customize label 2.
        yield np.array([data]).astype(np.float32), np.array([label1]).astype(np.float32), np.array([label2]).astype(np.float32)

# Define a dataset.
dataset = ds.GeneratorDataset(list(get_multilabel_data(5)), column_names=['data', 'label1', 'label2'])

# Print the dataset.
for data in dataset.create_dict_iterator():
    print("data:[{:9.5f}]  ".format(data['data'].asnumpy()[0]),
          "label1:[{:9.5f}]  ".format(data['label1'].asnumpy()[0]),
          "label2:[{:9.5f}]".format(data['label2'].asnumpy()[0]))

# Print the number of data records.
print("data size:", dataset.get_dataset_size())
```

```text
    data:[  3.73002]   label1:[  0.66925]   label2:[  1.01829]
    data:[  0.66331]   label1:[  0.38375]   label2:[  1.31552]
    data:[  5.00289]   label1:[  0.97772]   label2:[  1.74817]
    data:[ -4.39112]   label1:[  0.57856]   label2:[  1.10323]
    data:[ -8.03306]   label1:[ -0.15778]   label2:[  1.95789]
    data size: 5
```

According to the preceding information, there are five groups of datasets generated by the customized dataset generation function, and each group of data has two labels.
